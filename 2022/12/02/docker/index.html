<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/qwe/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/qwe/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="docker学习," />










<meta name="description" content="docker学习的一些记录">
<meta property="og:type" content="article">
<meta property="og:title" content="docker">
<meta property="og:url" content="http://example.com/2022/12/02/docker/index.html">
<meta property="og:site_name" content="hfy up up">
<meta property="og:description" content="docker学习的一些记录">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230314214217983.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230314214724750.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230314235324647.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230315234405930.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230316000021701.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230316002527497.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230317223129368.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230317223312695.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230317223500994.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/Users/HuangFeiYang/AppData/Roaming/Typora/typora-user-images/image-20230317225853429.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230317230242897.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230317230348681.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230317230558883.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230318145050417.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/Users/HuangFeiYang/AppData/Roaming/Typora/typora-user-images/image-20230318151319928.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230318160912848.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230318201232157.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230318201217837.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230326193327409.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/Pytorch%5Cimage-20230319150113726.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319151844691.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319151946736.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319151915603.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319153948906.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319154347724.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319160203431.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319164953072.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319165737335.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319170313700.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319190725042.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319191153812.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319215911859.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319222941973.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230319230025675.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230326153637538.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230326153720179.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230326154355920.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230326175951196.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230326203434034.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230326205251418.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230327231458465.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230327231507829.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230329000115832.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230329000110612.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230329000205809.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230329000529071.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230329224842090.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230330160159171.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331202446893.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331203659894.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331205142877.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331205548935.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331210835080.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331210859426.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331211341185.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331211731990.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331213417574.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331214413476.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331213800033.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331214006174.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331214724606.png">
<meta property="og:image" content="http://example.com/2022/12/02/docker/image-20230331222223486.png">
<meta property="article:published_time" content="2022-12-02T12:14:30.000Z">
<meta property="article:modified_time" content="2023-03-31T14:24:31.881Z">
<meta property="article:author" content="feiyangHuang">
<meta property="article:tag" content="docker学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/12/02/docker/image-20230314214217983.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/2022/12/02/docker/"/>





  <title>docker | hfy up up</title>
  








<meta name="generator" content="Hexo 5.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hfy up up</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/02/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hfy up up">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">docker</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-12-02T20:14:30+08:00">
                2022-12-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>docker学习的一些记录</p>
<a id="more"></a>

<h2 id="1-Docker学习"><a href="#1-Docker学习" class="headerlink" title="1. Docker学习"></a>1. Docker学习</h2><ul>
<li>Docker概述</li>
<li>Docker安装</li>
<li>Docker命令<ul>
<li>镜像命令</li>
<li>容器命令</li>
<li>操作命令</li>
<li>…</li>
</ul>
</li>
<li>Docker镜像！</li>
<li>容器数据卷！</li>
<li>DockerFile</li>
<li>Docker网络原理</li>
<li>IDEA整合Docker</li>
<li>集群（Docker Compose）</li>
<li>Docker Swarm</li>
<li>CI\CD Jenkins</li>
</ul>
<h2 id="2-Docker概述"><a href="#2-Docker概述" class="headerlink" title="2. Docker概述"></a>2. Docker概述</h2><h3 id="2-1-Docker为什么会出现？"><a href="#2-1-Docker为什么会出现？" class="headerlink" title="2.1 Docker为什么会出现？"></a>2.1 Docker为什么会出现？</h3><p>一款产品：开发–上线 两套环境！应用环境，应用配置！</p>
<p>开发 ——-运维。 问题： 在我的电脑上可以运行！ 版本更新，导致服务不可用！对于运维来说，考验就十分大？</p>
<p>开发即运维</p>
<p>环境配置是十分的麻烦，每一个机器都要部署环境（集群Redis、Es、Hadoop…..）！费时费力。</p>
<p>发布一个项目（jar  + （Redis MySQL jdk ES）），项目能不能都带上环境安装打包！</p>
<p>之前在服务器配置一个应用的环境 Redis MySQL jdk ES Hadoop，配置超麻烦，不能够跨越平台。</p>
<p>Windows，最后发布到Linux！</p>
<p>传统：开发jar，运维来做！</p>
<p>现在：开发打包部署上线，一套流程做完！</p>
<p>java – apk – 发布（应用商店） –张三使用apk —安装即可用！</p>
<p>java – jar（环境） — 打包项目带上环境（镜像） — （Docker仓库：商店）—下载我们发布的镜像 — 直接运行即可！</p>
<p>Docker给以上的问题，提出了解决方案！</p>
<p>docker的思想来源于集装箱！</p>
<p>JRE – 多个应用（端口冲突） — 原来都是交叉的！</p>
<p>隔离： Docker核心思想！打包装箱！每个箱子是互相隔离的。</p>
<p>本质：所有的技术都是因为出现了一些问题，我们需要去解决，才去学习！</p>
<h3 id="2-2-Docker的历史"><a href="#2-2-Docker的历史" class="headerlink" title="2.2 Docker的历史"></a>2.2 Docker的历史</h3><p><img src="/2022/12/02/docker/image-20230314214217983.png" alt="image-20230314214217983"></p>
<p>Docker是基于Go语言开发的开源项目。</p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<h3 id="2-3-Docker能干吗？"><a href="#2-3-Docker能干吗？" class="headerlink" title="2.3 Docker能干吗？"></a>2.3 Docker能干吗？</h3><blockquote>
<p>之前的虚拟机技术</p>
</blockquote>
<p><img src="/2022/12/02/docker/image-20230314214724750.png" alt="image-20230314214724750"></p>
<p>虚拟机技术缺点：</p>
<p>1、资源占用十分多</p>
<p>2、冗余步骤多</p>
<p>3、启动很慢！</p>
<blockquote>
<p>容器化技术</p>
</blockquote>
<p>容器化技术不是模拟的一个完整的操作系统</p>
<p><img src="/2022/12/02/docker/image-20230314235324647.png" alt="image-20230314235324647"></p>
<blockquote>
<p>比较Docker和虚拟机技术的不同</p>
</blockquote>
<ul>
<li>传统虚拟机，虚拟出一套硬件，运行一个完整的操作系统，然后在这个系统上安装软件。</li>
<li>容器内的应用直接运行在宿主机的内容，容器是没有自己的内核的，也没有虚拟我们的硬件，所以就轻便了。</li>
<li>每个容器间是互相隔离，每个容器内都有一个属于自己的文件系统，互不影响。</li>
</ul>
<blockquote>
<p>DevOps（开发、运维）</p>
</blockquote>
<p><strong>应用更快速的交付和部署</strong></p>
<p>传统：一堆帮助文档，安装程序</p>
<p>Docker:打包镜像发布测试，一键运行</p>
<p><strong>更便捷的升级和扩缩容</strong></p>
<p>使用了Docker之后，我们的部署就跟搭积木一样！</p>
<p>(SpringBoot1.5  Redis5  Tomcat8)升级！</p>
<p>项目打包为一个镜像，扩展服务器A! 在服务器B上一键运行容器。</p>
<p><strong>更简单的系统运维</strong></p>
<p>在容器化之后，我们的开发，测试环境都高度一致的。</p>
<p><strong>更高效的计算资源利用：</strong></p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上运行很多的容器实例！服务器的性能可以被压榨到极致！</p>
<h3 id="2-4-Docker的基本组成"><a href="#2-4-Docker的基本组成" class="headerlink" title="2.4 Docker的基本组成"></a>2.4 Docker的基本组成</h3><p><img src="/2022/12/02/docker/image-20230315234405930.png" alt="image-20230315234405930"></p>
<p><strong>镜像（image）</strong></p>
<p>docker镜像就好比是一个模板，可以通过这个模板来创建容器服务，tomcat镜像===&gt;run===&gt;tomcat01容器（提供服务），通过镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）。</p>
<p><strong>容器（container）</strong></p>
<p>Docker利用容器技术，独立运行一个或者一个组应用，通过镜像来创建的。启动，停止，删除，基本命令！</p>
<p>目前可以把这个容器理解为一个简易的Linux系统。</p>
<p><strong>仓库（repository）</strong></p>
<p>仓库就是存放镜像的地方！</p>
<p>仓库分为共有仓库和私有仓库！</p>
<p>Docker Hub（默认是国外的）</p>
<p>阿里云…都有容器服务（配置镜像加速）</p>
<h3 id="2-5-安装Docker"><a href="#2-5-安装Docker" class="headerlink" title="2.5 安装Docker"></a>2.5 安装Docker</h3><blockquote>
<p>环境准备</p>
</blockquote>
<ol>
<li>需要会一点点的Linux基础</li>
<li>CentOS 7</li>
<li>我们使用Xshell连接远程服务器进行操作！</li>
</ol>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br><span class="line">3.10.0-1127.19.1.el7.x86_64</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br></pre></td></tr></table></figure>

<p>然后查看官网安装教程</p>
<p><img src="/2022/12/02/docker/image-20230316000021701.png" alt="image-20230316000021701"></p>
<p><strong>第一步卸载</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p><strong>需要的安装包</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>

<p><strong>设置镜像的仓库</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">更新yum软件包索引</span><br><span class="line">yum makecache fast </span><br></pre></td></tr></table></figure>

<p><strong>安装Docker相关的</strong> docker-ce社区版 ee企业版</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p><strong>启动Docker</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<p><strong>测试Docker</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230316002527497.png" alt="image-20230316002527497"></p>
<p><strong>查看一下下载的hello-world镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>了解：卸载docker</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras</span><br><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>

<h3 id="2-6-配置阿里云加速"><a href="#2-6-配置阿里云加速" class="headerlink" title="2.6 配置阿里云加速"></a>2.6 配置阿里云加速</h3><p>1、登录阿里云找到镜像容器服务。</p>
<p><img src="/2022/12/02/docker/image-20230317223129368.png" alt="image-20230317223129368"></p>
<p>2、找到镜像加速的地址。</p>
<p><img src="/2022/12/02/docker/image-20230317223312695.png" alt="image-20230317223312695"></p>
<p><img src="/2022/12/02/docker/image-20230317223500994.png" alt="image-20230317223500994"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://i9a5ub2w.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="2-7-回顾HelloWorld的流程"><a href="#2-7-回顾HelloWorld的流程" class="headerlink" title="2.7 回顾HelloWorld的流程"></a>2.7 回顾HelloWorld的流程</h3><p><img src="/2022/12/02/docker/Users\HuangFeiYang\AppData\Roaming\Typora\typora-user-images\image-20230317225853429.png" alt="image-20230317225853429"></p>
<h3 id="2-8-底层原理"><a href="#2-8-底层原理" class="headerlink" title="2.8 底层原理"></a>2.8 底层原理</h3><p><strong>Docker是怎么工作的？</strong></p>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问！</p>
<p>DockerServer接收到Docker-Client的指令，就会执行这个命令！</p>
<p><img src="/2022/12/02/docker/image-20230317230242897.png" alt="image-20230317230242897"></p>
<p><strong>Docker为什么比VM快?</strong></p>
<p>1、Docker有着比虚拟机更少的抽象层。</p>
<p>2、Docker利用的是宿主机的内核，vm需要是Guest OS。</p>
<p><img src="/2022/12/02/docker/image-20230317230348681.png" alt="image-20230317230348681"></p>
<p>所以说，新建一个容器的时候，docker不需要像虚拟机一样重新加载一个操作系统内核，避免引导。虚拟机是加载Guest OS，分钟级别的，而docker是利用宿主机的操作系统的，省略了这个复杂的过程，秒级！</p>
<p><img src="/2022/12/02/docker/image-20230317230558883.png" alt="image-20230317230558883"></p>
<p>之后学习完毕所有的命令，再回过头来看这段理论，就会很清晰！</p>
<h2 id="3-Docker的常用命令"><a href="#3-Docker的常用命令" class="headerlink" title="3. Docker的常用命令"></a>3. Docker的常用命令</h2><h3 id="3-1-帮助命令"><a href="#3-1-帮助命令" class="headerlink" title="3.1 帮助命令"></a>3.1 帮助命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version  # 显示docker的版本信息</span><br><span class="line">docker info  # 显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker 命令 --help # 万能命令，帮助命令</span><br></pre></td></tr></table></figure>

<p>docker帮助文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<h3 id="3-2-镜像命令"><a href="#3-2-镜像命令" class="headerlink" title="3.2 镜像命令"></a>3.2 镜像命令</h3><p><strong>docker images</strong> 查看所有本地的主机上的镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">hello-world   latest    feb5d9fea6a5   17 months ago   13.3kB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解释</span></span><br><span class="line">REPOSITORY  仓库的仓库源</span><br><span class="line">TAG         镜像的标签</span><br><span class="line">IMAGE ID	镜像的id</span><br><span class="line">CREATED		镜像的创建时间</span><br><span class="line">SIZE		镜像的大小</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             Show all images (default hides intermediate images) # 显示所有镜像</span><br><span class="line">  -q, --quiet           Only show image IDs    # 只显示ID</span><br></pre></td></tr></table></figure>

<p><strong>docker search</strong> 搜索镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker search mysql</span><br><span class="line">NAME                            DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                           MySQL is a widely used, open-source relation…   13947     [OK]       </span><br><span class="line">mariadb                         MariaDB Server is a high performing open sou…   5316      [OK]       </span><br><span class="line">percona                         Percona Server is a fork of the MySQL relati…   601       [OK]       </span><br><span class="line">phpmyadmin                      phpMyAdmin - A web interface for MySQL and M…   762       [OK]       </span><br><span class="line">circleci/mysql                  MySQL is a widely used, open-source relation…   29                   </span><br><span class="line">bitnami/mysql                   Bitnami MySQL Docker Image                      80                   [OK]</span><br><span class="line">bitnami/mysqld-exporter                                                         4                    </span><br><span class="line">ubuntu/mysql                    MySQL open source fast, stable, multi-thread…   43                   </span><br><span class="line">cimg/mysql                                                                      0                    </span><br><span class="line">rapidfort/mysql                 RapidFort optimized, hardened image for MySQL   14                   </span><br><span class="line">google/mysql                    MySQL server for Google Compute Engine          23                   [OK]</span><br><span class="line">ibmcom/mysql-s390x              Docker image for mysql-s390x                    2                    </span><br><span class="line">rapidfort/mysql8-ib             RapidFort optimized, hardened image for MySQ…   0                    </span><br><span class="line">hashicorp/mysql-portworx-demo                                                   0                    </span><br><span class="line">newrelic/mysql-plugin           New Relic Plugin for monitoring MySQL databa…   1                    [OK]</span><br><span class="line">rapidfort/mysql-official        RapidFort optimized, hardened image for MySQ…   0                    </span><br><span class="line">databack/mysql-backup           Back up mysql databases to... anywhere!         82                   </span><br><span class="line">linuxserver/mysql               A Mysql container, brought to you by LinuxSe…   38                   </span><br><span class="line">mirantis/mysql                                                                  0                    </span><br><span class="line">docksal/mysql                   MySQL service images for Docksal - https://d…   0                    </span><br><span class="line">vitess/mysqlctld                vitess/mysqlctld                                1                    [OK]</span><br><span class="line">linuxserver/mysql-workbench                                                     48                   </span><br><span class="line">bitnamicharts/mysql                                                             0                    </span><br><span class="line">eclipse/mysql                   Mysql 5.7, curl, rsync                          0                    [OK]</span><br><span class="line"><span class="meta">#</span><span class="bash">  可选项，通过搜藏来过滤</span></span><br><span class="line">--filter=STARS=3000  # 搜索出来的镜像就是STARS大于3000的</span><br><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker search mysql --filter=STARS=3000</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   13947     [OK]       </span><br><span class="line">mariadb   MariaDB Server is a high performing open sou…   5316      [OK]  </span><br></pre></td></tr></table></figure>

<p><strong>docker help</strong> 下载镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker pull --help</span><br><span class="line"></span><br><span class="line">Usage:  docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span><br><span class="line"></span><br><span class="line">Download an image from a registry</span><br><span class="line"></span><br><span class="line">Aliases:</span><br><span class="line">  docker image pull, docker pull</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --all-tags                Download all tagged images in the repository</span><br><span class="line">      --disable-content-trust   Skip image verification (default true)</span><br><span class="line">      --platform string         Set platform if server is multi-platform capable</span><br><span class="line">  -q, --quiet                   Suppress verbose output</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker pull mysql</span><br><span class="line">Using default tag: latest  # 如果不写tag，默认就是latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">72a69066d2fe: Pull complete   # 分层下载， docker image的核心，联合文件系统</span><br><span class="line">93619dbc5b36: Pull complete </span><br><span class="line">99da31dd6142: Pull complete </span><br><span class="line">626033c43d70: Pull complete </span><br><span class="line">37d5d7efb64e: Pull complete </span><br><span class="line">ac563158d721: Pull complete </span><br><span class="line">d2ba16033dad: Pull complete </span><br><span class="line">688ba7d5c01a: Pull complete </span><br><span class="line">00e060b6d11d: Pull complete </span><br><span class="line">1c04857f594f: Pull complete </span><br><span class="line">4d7cfa90e6ea: Pull complete </span><br><span class="line">e0431212d27d: Pull complete </span><br><span class="line">Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709  # 签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest  # 真实地址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 等价</span></span><br><span class="line">docker pull mysql</span><br><span class="line">== 等价</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>

<p><strong>docker rmi</strong> 删除镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 容器id # 删除指定的容器</span><br><span class="line">docker rmi -f 容器id 容器id 容器id  # 删除多个容器</span><br><span class="line">docker rmi -f $(docker images -aq)  # 删除全部容器</span><br></pre></td></tr></table></figure>

<h3 id="3-3-容器命令"><a href="#3-3-容器命令" class="headerlink" title="3.3 容器命令"></a>3.3 容器命令</h3><p><strong>说明：我们有了镜像才可以创建容器，Linux，下载一个centos镜像来学习</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<h4 id="3-3-1-新建容器并启动"><a href="#3-3-1-新建容器并启动" class="headerlink" title="3.3.1 新建容器并启动"></a>3.3.1 新建容器并启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明</span></span><br><span class="line">--name=&quot;Name&quot;   # 容器名字 tomcat01 tomcat02 用来区分容器</span><br><span class="line">-d				# 后台方式运行</span><br><span class="line">-it				# 使用交互方式运行</span><br><span class="line">-p				# 指定容器的端口 -p 8080:8080</span><br><span class="line">		-p 主机端口:容器端口</span><br><span class="line">		-p 容器端口</span><br><span class="line">		容器端口</span><br><span class="line">-P				# 随机指定端口</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动并进入容器</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">centos       latest    5d0da3dc9764   18 months ago   231MB</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker run -it centos /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从容器中退回主机</span></span><br><span class="line">[root@c28a740970af /]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有运行中的容器</span></span><br><span class="line">docker ps </span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出当前运行的容器+所有曾经运行过的容器</span></span><br><span class="line">docker ps -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示最近的n条</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker ps -a -n=1</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS                        PORTS     NAMES</span><br><span class="line">c28a740970af   centos    &quot;/bin/bash&quot;   34 minutes ago   Exited (127) 30 minutes ago             naughty_swanson</span><br><span class="line"><span class="meta">#</span><span class="bash"> -q只显示当前的编号</span></span><br><span class="line">docker ps -aq  #显示全部容器的编号</span><br><span class="line">exit # 直接停止容器并退出</span><br><span class="line">ctrl+P+Q  # 容器不停止退出</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker run -it centos /bin/bash</span><br><span class="line">按 ctrl + P + Q</span><br><span class="line">[root@fdb41764eb9b /]# [root@iZ0jl8mpf6u9turvttqoldZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">fdb41764eb9b   centos    &quot;/bin/bash&quot;   25 seconds ago   Up 25 seconds             exciting_roentgen</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-删除容器"><a href="#3-3-2-删除容器" class="headerlink" title="3.3.2 删除容器"></a>3.3.2 删除容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id  # 删除指定的容器，不能删除正在运行的容器，如果要删除，需要加上-f 即rm -f</span><br><span class="line">docker rm -f $&#123;docker ps -aq&#125;  #删除全部容器</span><br><span class="line">docker ps -a -q | xargs docker rm # 也可以删除全部容器</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-启动和停止容器操作"><a href="#3-3-3-启动和停止容器操作" class="headerlink" title="3.3.3 启动和停止容器操作"></a>3.3.3 启动和停止容器操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id	# 启动容器</span><br><span class="line">docker restart 容器id	# 重启容器</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop 容器id	# 停止当前正在运行的容器</span><br><span class="line">docker kill 容器id	# 强制停止当前容器</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-常用的其他命令"><a href="#3-3-4-常用的其他命令" class="headerlink" title="3.3.4 常用的其他命令"></a>3.3.4 常用的其他命令</h4><h5 id="3-3-4-1-后台启动"><a href="#3-3-4-1-后台启动" class="headerlink" title="3.3.4.1 后台启动"></a><strong>3.3.4.1 后台启动</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker run -d centos  # 后台启动</span><br><span class="line">8c4bfb725d75e218024c7b26252767f16ce098f1c2ee8fa29b25aca622efb781</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 问题 docker ps的时候发现停止了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 常见的坑，docker 容器使用后台运行，就必须有一个前台进程，docker发现没有应用了，就会自动停止</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx，容器启动发现自己没有启动服务，就会立即停止，就是没有运行程序了</span></span><br></pre></td></tr></table></figure>

<h5 id="3-3-4-2-查看日志"><a href="#3-3-4-2-查看日志" class="headerlink" title="3.3.4.2 查看日志"></a><strong>3.3.4.2 查看日志</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --tail 容器id  </span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">&quot;while True;do echo fy; sleep 1;done&quot;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker run -d centos /bin/sh -c &quot;while true;do echo fy; sleep 1;done&quot;</span><br><span class="line">e2d9719d349ebb73cdea8fc0b2be06584f60a558a7db97d8ae15bac9ea18fa6f</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED        STATUS                  PORTS     NAMES</span><br><span class="line">e2d9719d349e   centos    &quot;/bin/sh -c &#x27;while t…&quot;   1 second ago   Up Less than a second             hardcore_gauss</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker logs -f -t --tail 10  e2d9719d349e</span><br><span class="line">2023-03-18T06:11:59.696912119Z fy</span><br><span class="line">2023-03-18T06:12:00.699118077Z fy</span><br><span class="line">2023-03-18T06:12:01.701246597Z fy</span><br><span class="line">2023-03-18T06:12:02.703428888Z fy</span><br><span class="line">2023-03-18T06:12:03.705632434Z fy</span><br><span class="line">2023-03-18T06:12:04.707738760Z fy</span><br><span class="line">2023-03-18T06:12:05.710006389Z fy</span><br><span class="line">2023-03-18T06:12:06.712179667Z fy</span><br><span class="line">2023-03-18T06:12:07.714304038Z fy</span><br><span class="line">2023-03-18T06:12:08.716286875Z fy</span><br><span class="line">2023-03-18T06:12:09.718419425Z fy</span><br><span class="line">-tf 显示日志</span><br><span class="line">--tail number # 要显示的日志条数，不加显示全部</span><br></pre></td></tr></table></figure>

<h5 id="3-3-4-3-查看容器中的进程信息"><a href="#3-3-4-3-查看容器中的进程信息" class="headerlink" title="3.3.4.3 查看容器中的进程信息"></a>3.3.4.3 查看容器中的进程信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器id</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker top e2d9719d349e</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                16728               16709               0                   14:15               ?                   00:00:00            /bin/sh -c while true;do echo fy; sleep 1;done</span><br><span class="line">root                16785               16728               0                   14:15               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br></pre></td></tr></table></figure>

<h5 id="3-3-4-4-查看镜像中的元数据信息"><a href="#3-3-4-4-查看镜像中的元数据信息" class="headerlink" title="3.3.4.4 查看镜像中的元数据信息"></a>3.3.4.4 查看镜像中的元数据信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker inspect e2d9719d349e</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;e2d9719d349ebb73cdea8fc0b2be06584f60a558a7db97d8ae15bac9ea18fa6f&quot;,  # 容器id只是其中一部分</span><br><span class="line">        &quot;Created&quot;: &quot;2023-03-18T06:11:13.319140974Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo fy; sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 16728,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2023-03-18T06:15:10.737887826Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;2023-03-18T06:12:52.845056608Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/e2d9719d349ebb73cdea8fc0b2be06584f60a558a7db97d8ae15bac9ea18fa6f/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/e2d9719d349ebb73cdea8fc0b2be06584f60a558a7db97d8ae15bac9ea18fa6f/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/e2d9719d349ebb73cdea8fc0b2be06584f60a558a7db97d8ae15bac9ea18fa6f/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/e2d9719d349ebb73cdea8fc0b2be06584f60a558a7db97d8ae15bac9ea18fa6f/e2d9719d349ebb73cdea8fc0b2be06584f60a558a7db97d8ae15bac9ea18fa6f-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/hardcore_gauss&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                58,</span><br><span class="line">                210</span><br><span class="line">            ],</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: [],</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/589af94f9ebb5e5d7da9417ed3265d8d55e64689d492cfee49689bc89b268915-init/diff:/var/lib/docker/overlay2/79ba14333054bf179ebcb79830c4a72118c1f4b47c40fd56dd761da7163c2691/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/589af94f9ebb5e5d7da9417ed3265d8d55e64689d492cfee49689bc89b268915/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/589af94f9ebb5e5d7da9417ed3265d8d55e64689d492cfee49689bc89b268915/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/589af94f9ebb5e5d7da9417ed3265d8d55e64689d492cfee49689bc89b268915/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;e2d9719d349e&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo fy; sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20210915&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;6b6349f8442307d522415046234d69ac19ea7a5c0ea86f4c4d9bbcacc26f0ce3&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/6b6349f84423&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;620ca63f8720cb4e8fd5ffe5c35a8fe5f872198141e492d7bb08c6945f188b5a&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;807ab76623e844005761893d4c5f9c404948c7a85a9dff4f3d8c69c0a5fbcda7&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;620ca63f8720cb4e8fd5ffe5c35a8fe5f872198141e492d7bb08c6945f188b5a&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h5 id="3-3-4-5-进入正在运行的容器"><a href="#3-3-4-5-进入正在运行的容器" class="headerlink" title="3.3.4.5 进入正在运行的容器"></a>3.3.4.5 进入正在运行的容器</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们通常容器都是以后台的形式运行的，需要进入容器，修改一些配置</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">dokcer exec -it 容器id /bin/bash</span><br><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker exec -it e2d9719d349e /bin/bash</span><br><span class="line">[root@e2d9719d349e /]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 06:24 ?        00:00:00 /bin/sh -c while true;do echo fy; sleep 1;done</span><br><span class="line">root         9     0  0 06:24 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        41     1  0 06:25 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br><span class="line">root        42     9  0 06:25 pts/0    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker attach -it 容器id /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 正在执行当前的代码</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec # 进入容器之后打开一个新的终端，可以在里面操作（常用）</span><br><span class="line">docker attach 进入容器正在执行的终端，不会启动新的进程！</span><br></pre></td></tr></table></figure>

<h5 id="3-3-4-6-从容器内拷贝文件到主机上"><a href="#3-3-4-6-从容器内拷贝文件到主机上" class="headerlink" title="3.3.4.6 从容器内拷贝文件到主机上"></a>3.3.4.6 从容器内拷贝文件到主机上</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内的路径 主机路径</span><br><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker cp  66e3ba0662b4:home/fy.java /home</span><br><span class="line">Preparing to copy...</span><br><span class="line">Successfully copied 1.536kB to /home</span><br></pre></td></tr></table></figure>

<h4 id="3-4-总结"><a href="#3-4-总结" class="headerlink" title="3.4 总结"></a>3.4 总结</h4><p><img src="/2022/12/02/docker/image-20230318145050417.png" alt="image-20230318145050417"></p>
<h3 id="3-4-Docker练习使用"><a href="#3-4-Docker练习使用" class="headerlink" title="3.4. Docker练习使用"></a>3.4. Docker练习使用</h3><h4 id="3-4-1部署Nginx"><a href="#3-4-1部署Nginx" class="headerlink" title="3.4.1部署Nginx"></a>3.4.1部署Nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">1、 **搜索镜像 ** search   docker hub可以搜索</span><br><span class="line">2、 **下载镜像** pull</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -d 后台运行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --name 给容器命名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -p 宿主机端口:容器内端口</span></span><br><span class="line">3、 **运行测试** docker run -d --name nginx01 -p:3344:80 nginx </span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                                   NAMES</span><br><span class="line">aa2ec73936c9   nginx     &quot;/docker-entrypoint.…&quot;   6 minutes ago   Up 6 minutes   0.0.0.0:3344-&gt;80/tcp, :::3344-&gt;80/tcp   nginx01</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@aa2ec73936c9:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br></pre></td></tr></table></figure>

<p><strong>端口暴露的概念</strong></p>
<p><img src="/2022/12/02/docker/Users\HuangFeiYang\AppData\Roaming\Typora\typora-user-images\image-20230318151319928.png" alt="image-20230318151319928"></p>
<p>思考问题：我们每次改动nginx配置文件，都需要进入容器内部？十分麻烦，我要是可以在容器外部提供一个映射路径，达到在主机修改文件名，容器内部就可以自动修改？-v 数据卷？</p>
<h4 id="3-4-2-部署Tomact"><a href="#3-4-2-部署Tomact" class="headerlink" title="3.4.2 部署Tomact"></a>3.4.2 部署Tomact</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 官方文档的使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们之前的启动都是后台，停止了容器之后，容器还是可以查到， docker run -it --rm，一般用来测试，用完即删</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载再启动</span></span><br><span class="line">docker pull tomcat:9.0</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# docker run -d -p 3355:8080 --name tomcat01 tomcat:9.0 </span><br><span class="line">8e01146961868eb4dbb0839936fd9eb61377a5b9d656b57991ef3ea9d4936d42</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND             CREATED         STATUS         PORTS                                       NAMES</span><br><span class="line">8e0114696186   tomcat:9.0   &quot;catalina.sh run&quot;   5 seconds ago   Up 4 seconds   0.0.0.0:3355-&gt;8080/tcp, :::3355-&gt;8080/tcp   tomcat01</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试访问没有问题 但是显示404，进入容器检查</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# docker exec -it tomcat01 /bin/bash</span><br><span class="line">root@8e0114696186:/usr/local/tomcat# ls -al</span><br><span class="line">total 172</span><br><span class="line">drwxr-xr-x 1 root root  4096 Dec 22  2021 .</span><br><span class="line">drwxr-xr-x 1 root root  4096 Dec 22  2021 ..</span><br><span class="line">-rw-r--r-- 1 root root 18970 Dec  2  2021 BUILDING.txt</span><br><span class="line">-rw-r--r-- 1 root root  6210 Dec  2  2021 CONTRIBUTING.md</span><br><span class="line">-rw-r--r-- 1 root root 57092 Dec  2  2021 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root  2333 Dec  2  2021 NOTICE</span><br><span class="line">-rw-r--r-- 1 root root  3378 Dec  2  2021 README.md</span><br><span class="line">-rw-r--r-- 1 root root  6898 Dec  2  2021 RELEASE-NOTES</span><br><span class="line">-rw-r--r-- 1 root root 16507 Dec  2  2021 RUNNING.txt</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec 22  2021 bin</span><br><span class="line">drwxr-xr-x 1 root root  4096 Mar 18 07:26 conf</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec 22  2021 lib</span><br><span class="line">drwxrwxrwx 1 root root  4096 Mar 18 07:26 logs</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec 22  2021 native-jni-lib</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec 22  2021 temp</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec 22  2021 webapps</span><br><span class="line">drwxr-xr-x 7 root root  4096 Dec  2  2021 webapps.dist</span><br><span class="line">drwxrwxrwx 2 root root  4096 Dec  2  2021 work</span><br><span class="line">root@8e0114696186:/usr/local/tomcat# cd webapps</span><br><span class="line">root@8e0114696186:/usr/local/tomcat/webapps# ls</span><br><span class="line">root@8e0114696186:/usr/local/tomcat/webapps# </span><br><span class="line"><span class="meta">#</span><span class="bash"> 1、 发现问题，Linux命令太少了 2、没有webapps 阿里云的镜像的原因，默认是最小的镜像，所有不必要的都删除掉，但是webapps.dist下面有，我们可以复制过去</span></span><br><span class="line">root@8e0114696186:/usr/local/tomcat/webapps# cp ../webapps.dist/*  .</span><br><span class="line">cp: -r not specified; omitting directory &#x27;../webapps.dist/ROOT&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;../webapps.dist/docs&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;../webapps.dist/examples&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;../webapps.dist/host-manager&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;../webapps.dist/manager&#x27;</span><br><span class="line">root@8e0114696186:/usr/local/tomcat/webapps# cp -r ../webapps.dist/* </span><br></pre></td></tr></table></figure>

<p>我们以后部署项目，如果每次都要进入容器是十分麻烦的。我们要实在容器外部提供一个映射路径，webapps，我们在外部放置项目，自动同步到内部就好了！</p>
<h4 id="3-4-3-部署es-kibana"><a href="#3-4-3-部署es-kibana" class="headerlink" title="3.4.3 部署es + kibana"></a>3.4.3 部署es + kibana</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> es暴露的端口很多！</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es十分耗内存</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es的数据一般需要放置在安全目录！挂载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 	--net somenetwork ？ 网络配置 --net somenetwork</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">启动</span></span><br><span class="line">docker run -d --name elasticsearch  -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:tag</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动之后十分卡，linux卡住 docker stats查看cpu的状态</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es十分耗内存 1.xg. 1核2G！</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看docker stats</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试一下es是否成功了 curl localhsot:9200</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 赶紧关闭，增加内存的限制 加-e</span></span><br><span class="line">docker run -d --name elasticsearch  -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  增加了内存限制之后</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# docker run -d --name elasticsearch  -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br><span class="line">2cd6b9ed0c6cdbfdf85b2a0edad17dc30e78e53b1e907a335c377755ffacffd0</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# ls</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# docker stats</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   0.02%     1.181GiB / 1.694GiB   69.72%    586B / 0B   174MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT    MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   194.25%   1.19GiB / 1.694GiB   70.23%    586B / 0B   182MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT    MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   194.25%   1.19GiB / 1.694GiB   70.23%    586B / 0B   182MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT    MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   194.25%   1.19GiB / 1.694GiB   70.23%    586B / 0B   182MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   196.57%   1.191GiB / 1.694GiB   70.31%    656B / 0B   183MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   196.57%   1.191GiB / 1.694GiB   70.31%    656B / 0B   183MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   188.71%   1.206GiB / 1.694GiB   71.17%    656B / 0B   198MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   188.71%   1.206GiB / 1.694GiB   71.17%    656B / 0B   198MB / 246kB   20</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT    MEM %     NET I/O     BLOCK I/O       PIDS</span><br><span class="line">2cd6b9ed0c6c   elasticsearch   167.95%   1.22GiB / 1.694GiB   72.03%    656B / 0B   222MB / 246kB   21</span><br><span class="line">^C</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# ls</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;2cd6b9ed0c6c&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;ZzHmx_3IRvKPyxIbgBLn_w&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230318160912848.png" alt="image-20230318160912848"></p>
<h3 id="3-5-可视化"><a href="#3-5-可视化" class="headerlink" title="3.5. 可视化"></a>3.5. 可视化</h3><ul>
<li>portainer(先用这个)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>

<p><strong>什么是portainer?</strong></p>
<p>Docker的图形化管理工具！提供一个后台面板供我们操作！</p>
<p>创建账号密码，选择local。进入之后的页面</p>
<p><img src="/2022/12/02/docker/image-20230318201232157.png" alt="image-20230318201232157"></p>
<p><img src="/2022/12/02/docker/image-20230318201217837.png" alt="image-20230318201217837"></p>
<ul>
<li>Rancher(CI/CD za)</li>
</ul>
<h2 id="4-Docker镜像讲解"><a href="#4-Docker镜像讲解" class="headerlink" title="4. Docker镜像讲解"></a>4. Docker镜像讲解</h2><h3 id="4-1-镜像是什么"><a href="#4-1-镜像是什么" class="headerlink" title="4.1 镜像是什么"></a>4.1 镜像是什么</h3><p>​    镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。<br>​    所有的应用，直接打包docker镜像，就可以直接跑起来!<br>​    如何得到镜像</p>
<ul>
<li>从远程仓库下载。</li>
<li>朋友拷贝给你。</li>
<li>自己制作一个镜像DockerFile</li>
</ul>
<blockquote>
<p>UnionFS（联合文件系统）</p>
</blockquote>
<p>​    UnionFS( 联合文件系统）:Union文件系统 (UnionFS)是十种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtualfilesystem)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>​    特性:一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<blockquote>
<p> Docker镜像加载原理</p>
</blockquote>
<p>​    docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p>
<p><img src="/2022/12/02/docker/image-20230326193327409.png" alt="image-20230326193327409"></p>
<h3 id="4-2-分层理解"><a href="#4-2-分层理解" class="headerlink" title="4.2 分层理解"></a>4.2 分层理解</h3><blockquote>
<p>分层的镜像</p>
</blockquote>
<p><img src="/2022/12/02/docker/Pytorch%5Cimage-20230319150113726.png" alt="image-20230319150113726"></p>
<p>有already exists的</p>
<p>最大的好处，我觉得莫过于是资源共享了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机<br>只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服<br>务了，而且镜像的每一层都可以被共享。<br>查看镜像分层的方式可以通过 docker image inspect 命令！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect redis:latest</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#125;,</span><br><span class="line">&quot;RootFS&quot;: &#123;</span><br><span class="line">    &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">    &quot;Layers&quot;: [  # 每一层的文件镜像</span><br><span class="line">        &quot;sha256:2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f&quot;,</span><br><span class="line">        &quot;sha256:9b24afeb7c2f21e50a686ead025823cd2c6e9730c013ca77ad5f115c079b57cb&quot;,</span><br><span class="line">        &quot;sha256:4b8e2801e0f956a4220c32e2c8b0a590e6f9bd2420ec65453685246b82766ea1&quot;,</span><br><span class="line">        &quot;sha256:529cdb636f61e95ab91a62a51526a84fd7314d6aab0d414040796150b4522372&quot;,</span><br><span class="line">        &quot;sha256:9975392591f2777d6bf4d9919ad1b2c9afa12f9a9b4d260f45025ec3cc9b18ed&quot;,</span><br><span class="line">        &quot;sha256:8e5669d8329116b8444b9bbb1663dda568ede12d3dbcce950199b582f6e94952&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>理解：</p>
<p>所有的 Docker 镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之<br>上，创建新的镜像层。<br>举一个简单的例子，假如基于 Ubuntu Linux 16.04 创建一个新的镜像，这就是新镜像的第一层；如果<br>在该镜像中添加 Python包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就<br>会创建第三个镜像层。<br>该镜像当前已经包含 3 个镜像层，如下图所示（这只是一个用于演示的很简单的例子）。</p>
<p><img src="/2022/12/02/docker/image-20230319151844691.png" alt="image-20230319151844691"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了<br>一个简单的例子，每个镜像层包含 3 个文件，而镜像包含了来自两个镜像层的 6 个文件。</p>
<p><img src="/2022/12/02/docker/image-20230319151946736.png" alt="image-20230319151946736"></p>
<p>上图中的镜像层跟之前图中的略有区别，主要目的是便于展示文件。<br>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有 6 个文件，这是因为最上层中的文件<br>7 是文件 5 的一个更新版本。</p>
<p><img src="/2022/12/02/docker/image-20230319151915603.png" alt="image-20230319151915603"></p>
<p>​    这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新<br>镜像层添加到镜像当中。<br>​    Docker 通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统<br>一的文件系统。<br>​    Linux 上可用的存储引擎有 AUFS、Overlay2、Device Mapper、Btrfs 以及 ZFS。顾名思义，每种存储<br>引擎都基于 Linux 中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。<br>Docker 在 Windows 上仅支持 windowsfilter 一种存储引擎，该引擎基于 NTFS 文件系统之上实现了分<br>层和 CoW。<br>​    下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
<p><img src="/2022/12/02/docker/image-20230319153948906.png" alt="image-20230319153948906"></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>​    docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部！这一层就是我们通常说的容器层，容器之下的都叫做镜像层！</p>
<p><img src="/2022/12/02/docker/image-20230319154347724.png" alt="image-20230319154347724"></p>
<h3 id="4-3-commit镜像"><a href="#4-3-commit镜像" class="headerlink" title="4.3 commit镜像"></a>4.3 commit镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令和git类似</span></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名称:[:TAG]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动一个tomact容器</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat:9.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看并进入</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND             CREATED          STATUS          PORTS                                       NAMES</span><br><span class="line">b9c9edf3c7ef   tomcat:9.0   &quot;catalina.sh run&quot;   25 seconds ago   Up 24 seconds   0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcp   xenodochial_davinci</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker exec -it b9c9edf3c7ef /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将webapps.dist目录下的文件移动到webapps下面，以便有网站，这是我们的修改，然后发布镜像</span></span><br><span class="line">root@b9c9edf3c7ef:/usr/local/tomcat# cp webapps.dist/* webapps</span><br><span class="line">cp: -r not specified; omitting directory &#x27;webapps.dist/ROOT&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;webapps.dist/docs&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;webapps.dist/examples&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;webapps.dist/host-manager&#x27;</span><br><span class="line">cp: -r not specified; omitting directory &#x27;webapps.dist/manager&#x27;</span><br><span class="line">root@b9c9edf3c7ef:/usr/local/tomcat# cp -r webapps.dist/* webapps</span><br><span class="line">root@b9c9edf3c7ef:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt  CONTRIBUTING.md  LICENSE	NOTICE	README.md  RELEASE-NOTES  RUNNING.txt  bin  conf  lib  logs  native-jni-lib  temp  webapps  webapps.dist  work</span><br><span class="line">root@b9c9edf3c7ef:/usr/local/tomcat# cd webapps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改后的发布，将我们操作后的容器通过commit提交为一个镜像！我们以后就使用我们修改后的镜像即可，这是我们自己的一个修改过的镜像。</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND             CREATED         STATUS         PORTS                                       NAMES</span><br><span class="line">b9c9edf3c7ef   tomcat:9.0   &quot;catalina.sh run&quot;   4 minutes ago   Up 4 minutes   0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcp   xenodochial_davinci</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker commit -a=&quot;fy&quot; -m=&quot;add webapps app&quot; b9c9edf3c7ef tomcat02:1.0.1</span><br><span class="line">sha256:ab5a6c1fa1ce80ea9b0ea06226d0895890073c79c99bafc614b67ff0d4cbeee9</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat02              1.0.1     ab5a6c1fa1ce   7 seconds ago   685MB  # 新提交的镜像</span><br><span class="line">nginx                 latest    605c77e624dd   14 months ago   141MB</span><br><span class="line">tomcat                9.0       b8e65a4d736d   15 months ago   680MB</span><br><span class="line">redis                 latest    7614ae9453d1   15 months ago   113MB</span><br><span class="line">centos                latest    5d0da3dc9764   18 months ago   231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   2 years ago     79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   2 years ago     791MB</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230319160203431.png" alt="image-20230319160203431"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像，就好比以前学习VM的时候，快照！</span></span><br></pre></td></tr></table></figure>

<p>入门Docker了！</p>
<h2 id="5-容器数据卷"><a href="#5-容器数据卷" class="headerlink" title="5. 容器数据卷"></a>5. 容器数据卷</h2><h3 id="5-1-什么是容器数据卷"><a href="#5-1-什么是容器数据卷" class="headerlink" title="5.1 什么是容器数据卷"></a>5.1 什么是容器数据卷</h3><p>docker的理念回顾</p>
<p>将应用和环境打包成一个镜像！</p>
<p>数据？如果容器都在数据中，那我们把数据删除，数据就会丢失！需求，数据可以持久化。</p>
<p>MySQL，容器删了，删库跑路！需求：MySQL数据可以存储在本地！</p>
<p>容器之间有一个数据共享的技术！Docker数据中产生的数据，同步到本地！</p>
<p>这就是卷技术！目录的挂载，将我们容器内的目录，挂载到Linux上面！</p>
<p><img src="/2022/12/02/docker/image-20230319164953072.png" alt="image-20230319164953072"></p>
<p><strong>总结一句话：容器的持久化和同步操作！容器之间也可以数据共享的</strong></p>
<h3 id="5-2-使用数据卷"><a href="#5-2-使用数据卷" class="headerlink" title="5.2 使用数据卷"></a>5.2 使用数据卷</h3><blockquote>
<p>方式一：直接使用命令来挂载 -v</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -it -v 主机目录:容器内目录</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker run -it -v /home/ceshsi:/home centos /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以发现主机home目录下多了ceshi目录，创建文件之后也可以同步</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker inspect 容器id发现</span></span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">&quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">&quot;Source&quot;: &quot;/home/ceshsi&quot;,</span><br><span class="line">&quot;Destination&quot;: &quot;/home&quot;,</span><br><span class="line">&quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">&quot;RW&quot;: true,</span><br><span class="line">&quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230319165737335.png" alt="image-20230319165737335"></p>
<p>测试文件的同步</p>
<p><img src="/2022/12/02/docker/image-20230319170313700.png" alt="image-20230319170313700"></p>
<p>容器关了也能同步。</p>
<p>好处：以后我们修改只需要在本地修改即可，容器内会自动同步。</p>
<h3 id="5-3-实战：部署MySQL"><a href="#5-3-实战：部署MySQL" class="headerlink" title="5.3 实战：部署MySQL"></a>5.3 实战：部署MySQL</h3><p>思考，MySQL的数据持久化的问题。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拉取MySQL镜像</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ceshsi]# docker pull mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行容器，需要做数据挂载！ <span class="comment"># 安装启动MySQL，需要配置密码，这是要注意的</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 官方测试 docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动我们的mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -d 后台运行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -p 端口映射</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -v 卷挂载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -e 环境配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --name 容器名字</span></span><br><span class="line">docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw --name mysql01 mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 利用MySQL WorkBench 连接成功</span></span><br></pre></td></tr></table></figure>

<p>假设我们把数据删除，可以发现挂载到本地的数据卷依然没有丢失，这就实现了容器数据的持久化功能。</p>
<h3 id="5-4-具名和匿名挂载"><a href="#5-4-具名和匿名挂载" class="headerlink" title="5.4 具名和匿名挂载"></a>5.4 具名和匿名挂载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 匿名挂载</span></span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -p --name nginx01 -v /etc/nginx nginx</span><br></pre></td></tr></table></figure>

<p><strong>查询-volume命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker volume --help</span><br><span class="line"></span><br><span class="line">Usage:  docker volume COMMAND</span><br><span class="line"></span><br><span class="line">Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a volume</span><br><span class="line">  inspect     Display detailed information on one or more volumes</span><br><span class="line">  ls          List volumes</span><br><span class="line">  prune       Remove all unused local volumes</span><br><span class="line">  rm          Remove one or more volumes</span><br><span class="line"></span><br><span class="line">Run &#39;docker volume COMMAND --help&#39; for more information on a command.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>查看所有的volume情况</strong>，如果-v只写了容器内的路径，没有指定容器外的目录，这种就是匿名挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     7a1f5aaf35518155167b2586f9b5da02575d210b96a9417843e7cad7fcea0409</span><br><span class="line">local     7ba5b2e4f1eeea9c803cea9e990d7d0db58465b482b208e13925334f115c1498</span><br><span class="line">local     9afc33eac6182512495be4bfedc44fed92bf7a968c581514b67a1f8dbb1cc864</span><br><span class="line">local     40cae3beccd0aed908c72061f27e24b3d54037b85da2d44195965f7ea31c015e</span><br><span class="line">local     58a0d8e586f7d14892ac2dd1b9449c5c17e4ff1205850a33d36d313677d570cd</span><br><span class="line">local     67b74b87be68a099ebf1f6425d0c647ebdb7cf6ccbdd9105b04c0da67dd673db</span><br><span class="line">local     419f8c76d4c2e49956975972f9f59f705a36b846c20ddaaf22017a37c02c1f6c</span><br></pre></td></tr></table></figure>

<p>具名挂载，在-v之后本机位置不屑/ 只写名字</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker run -d -P -v fyjumingceshi:/etc/nginx --name nginx02  nginx</span><br><span class="line">94aee9bd8fee6e681220102e5506b2201591abdcac0d8b1c2ee42872fd91ff98</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有volume</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     7a1f5aaf35518155167b2586f9b5da02575d210b96a9417843e7cad7fcea0409</span><br><span class="line">local     7ba5b2e4f1eeea9c803cea9e990d7d0db58465b482b208e13925334f115c1498</span><br><span class="line">local     9afc33eac6182512495be4bfedc44fed92bf7a968c581514b67a1f8dbb1cc864</span><br><span class="line">local     40cae3beccd0aed908c72061f27e24b3d54037b85da2d44195965f7ea31c015e</span><br><span class="line">local     58a0d8e586f7d14892ac2dd1b9449c5c17e4ff1205850a33d36d313677d570cd</span><br><span class="line">local     67b74b87be68a099ebf1f6425d0c647ebdb7cf6ccbdd9105b04c0da67dd673db</span><br><span class="line">local     419f8c76d4c2e49956975972f9f59f705a36b846c20ddaaf22017a37c02c1f6c</span><br><span class="line">local     fyjumingceshi</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看某个特定volume的信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所有docker内的卷，没有指定目录的情况下都是在/var/lib/docker/volumes/+fyjumingceshi(名字)/_data</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker volume inspect fyjumingceshi</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2023-03-19T18:42:00+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/fyjumingceshi/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;fyjumingceshi&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 前往相应的文件夹即可看到</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# cd /var/lib/</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ lib]# ls</span><br><span class="line">alternatives  chrony  containerd  dhclient  games      logrotate  misc            os-prober  polkit-1  rpm        rsyslog  stateless  tuned</span><br><span class="line">authconfig    cloud   dbus        docker    initramfs  machines   NetworkManager  plymouth   postfix   rpm-state  selinux  systemd    yum</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ lib]# cd docker/</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker]# ls</span><br><span class="line">buildkit  containers  engine-id  image  network  overlay2  plugins  runtimes  swarm  tmp  volumes</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker]# cd volumes/</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ volumes]# ls</span><br><span class="line">40cae3beccd0aed908c72061f27e24b3d54037b85da2d44195965f7ea31c015e  67b74b87be68a099ebf1f6425d0c647ebdb7cf6ccbdd9105b04c0da67dd673db  9afc33eac6182512495be4bfedc44fed92bf7a968c581514b67a1f8dbb1cc864  metadata.db</span><br><span class="line">419f8c76d4c2e49956975972f9f59f705a36b846c20ddaaf22017a37c02c1f6c  7a1f5aaf35518155167b2586f9b5da02575d210b96a9417843e7cad7fcea0409  backingFsBlockDev</span><br><span class="line">58a0d8e586f7d14892ac2dd1b9449c5c17e4ff1205850a33d36d313677d570cd  7ba5b2e4f1eeea9c803cea9e990d7d0db58465b482b208e13925334f115c1498  fyjumingceshi</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ volumes]# cd fyjumingceshi/</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ fyjumingceshi]# ls</span><br><span class="line">_data</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ fyjumingceshi]# cd _data/</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ _data]# ls</span><br><span class="line">conf.d  fastcgi_params  mime.types  modules  nginx.conf  scgi_params  uwsgi_params</span><br></pre></td></tr></table></figure>

<p>我们通过匿名挂载可以方便地找到我们的一个卷，大多数情况在使用的<code>具名挂载</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如何确定是巨名挂载还是匿名挂载，还是指定路径挂载！</span></span><br><span class="line">-v 容器内路径 				# 匿名挂载</span><br><span class="line">-v 卷名(不带/):容器内路径	 # 具名挂载</span><br><span class="line">-v /宿主机路径:容器内路径		# 指定路径挂载！</span><br></pre></td></tr></table></figure>

<p>拓展：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过-v 容器内路径:ro rw可以改变读写权限</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ro <span class="built_in">readonly</span>	<span class="comment"># 只读</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rw readwrite	<span class="comment"># 可读可写</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一旦设置了容器内的权限，容器对我们挂载出来的内容就有限定了！</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ro 只要看到ro就说明这个路径只能通过宿主机来改变。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rw（默认）可读可写，宿主机和容器都可以改变和操作。</span></span><br><span class="line">docker run -d -P -v fyjumingceshi:/etc/nginx:ro --name nginx02  nginx</span><br></pre></td></tr></table></figure>

<h3 id="5-5-初识DockerFile"><a href="#5-5-初识DockerFile" class="headerlink" title="5.5 初识DockerFile"></a>5.5 初识DockerFile</h3><p><strong>DockerFile</strong>就是用来构建docker镜像的构建文件！命令脚本！</p>
<p>通过这个脚本可以生成一个镜像！镜像是一层一层的，脚本是一个一个的命令，每个命令都是一层！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ home]# mkdir docker-test-volume</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个dockerfile文件，名字可以随机，建议Dockerfile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件中的内容 指令(大写)，参数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里的每一个命令，都是镜像的一层</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker-test-volume]# vim dockerfile1</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker-test-volume]# cat dockerfile1 </span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;, &quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;--------end---------&quot;</span><br><span class="line"></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker-test-volume]# docker build -f ./dockerfile1 -t /fy/centos .</span><br><span class="line">[+] Building 0.0s (0/0)                                                                                                                                                                                           </span><br><span class="line">ERROR: invalid tag &quot;/fy/centos&quot;: invalid reference format</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker-test-volume]# ls</span><br><span class="line">dockerfile1</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker-test-volume]# docker build -f ./dockerfile1 -t fy/centos .</span><br><span class="line">[+] Building 0.1s (5/5) FINISHED                                                                                                                                                                                  </span><br><span class="line"> =&gt; [internal] load build definition from dockerfile1                                                                                                                                                        0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 132B                                                                                                                                                                         0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                                                                                            0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                                                                                              0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:latest                                                                                                                                             0.0s</span><br><span class="line"> =&gt; [1/1] FROM docker.io/library/centos                                                                                                                                                                      0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                                                                                                                       0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:ee0550ee2678c8a8d8812b615ea6c1106e129007661a1439081ad29e2e6a298a                                                                                                                 0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/fy/centos                                                                                                                                                                         0.0s</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker-test-volume]# ls</span><br><span class="line">dockerfile1</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ docker-test-volume]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat02              1.0.1     ab5a6c1fa1ce   3 hours ago     685MB</span><br><span class="line">nginx                 latest    605c77e624dd   14 months ago   141MB</span><br><span class="line">tomcat                9.0       b8e65a4d736d   15 months ago   680MB</span><br><span class="line">redis                 latest    7614ae9453d1   15 months ago   113MB</span><br><span class="line">mysql                 5.7       c20987f18b13   15 months ago   448MB</span><br><span class="line">fy/centos             latest    ee0550ee2678   18 months ago   231MB</span><br><span class="line">centos                latest    5d0da3dc9764   18 months ago   231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   2 years ago     79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   2 years ago     791MB</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230319190725042.png" alt="image-20230319190725042"></p>
<p>这个目录就是我们自己挂载的</p>
<p><img src="/2022/12/02/docker/image-20230319191153812.png" alt="image-20230319191153812"></p>
<p>红色的地方就是我们生成镜像的时候自动挂载的，数据卷目录，这个卷跟外部一定有一个对应的目录，匿名挂载。</p>
<p>通过查询其mount</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;eec3dd89ac1a611a18a1c0036bbe39e23b7febbe5a1cd52ff08c0cbc261756b6&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;/var/lib/docker/volumes/eec3dd89ac1a611a18a1c0036bbe39e23b7febbe5a1cd52ff08c0cbc261756b6/_data&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: true,</span><br><span class="line">        &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;8ffafee25c8d86d76d6577513beaec42e7d4e83e06e2c148e2980e1936c85e00&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;/var/lib/docker/volumes/8ffafee25c8d86d76d6577513beaec42e7d4e83e06e2c148e2980e1936c85e00/_data&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;volume01&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: true,</span><br><span class="line">        &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>在volume01里面创建一个文件</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@d4a1dc5a9649 volume01]# touch container.txt</span><br></pre></td></tr></table></figure>

<p><strong>在主机里面通过上面查询到的Source观察，测试文件已经同步过去了</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ _data]# cd /var/lib/docker/volumes/8ffafee25c8d86d76d6577513beaec42e7d4e83e06e2c148e2980e1936c85e00/_data</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ _data]# ls</span><br><span class="line">container.txt</span><br></pre></td></tr></table></figure>

<p>这种dockerfile的方式我们以后用的非常多，因为我们通常会构建自己的镜像！</p>
<h3 id="5-6-数据卷容器"><a href="#5-6-数据卷容器" class="headerlink" title="5.6 数据卷容器"></a>5.6 数据卷容器</h3><p>多个mysql同步数据！</p>
<p><img src="/2022/12/02/docker/image-20230319215911859.png" alt="image-20230319215911859"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 启动三个容器， 通过我们刚才自己写镜像起来</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230319222941973.png" alt="image-20230319222941973"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker run -it --name docker02 --volumes-from docker01 fy/centos </span><br><span class="line">[root@678cc73276ec /]# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  360 Mar 19 14:34 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Mar 19 14:34 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root 4096 Sep 15  2021 lost+found</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 105 root root    0 Mar 19 14:34 proc</span><br><span class="line">dr-xr-x---   2 root root 4096 Sep 15  2021 root</span><br><span class="line">drwxr-xr-x  11 root root 4096 Sep 15  2021 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Mar 19 11:11 sys</span><br><span class="line">drwxrwxrwt   7 root root 4096 Sep 15  2021 tmp</span><br><span class="line">drwxr-xr-x  12 root root 4096 Sep 15  2021 usr</span><br><span class="line">drwxr-xr-x  20 root root 4096 Sep 15  2021 var</span><br><span class="line">drwxr-xr-x   2 root root 4096 Mar 19 14:28 volume01</span><br><span class="line">drwxr-xr-x   2 root root 4096 Mar 19 14:28 volume02</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker attach 65596b96efe8  # 进入docker01创建文件看docker02能否看到</span><br><span class="line">[root@65596b96efe8 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01	volume02</span><br><span class="line">[root@65596b96efe8 /]# cd volume01</span><br><span class="line">[root@65596b96efe8 volume01]# touch docker01.txt</span><br><span class="line">[root@65596b96efe8 volume01]# read escape sequence</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# ls</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                                                  NAMES</span><br><span class="line">678cc73276ec   fy/centos   &quot;/bin/sh -c /bin/bash&quot;   6 minutes ago    Up 6 minutes                                                           docker02</span><br><span class="line">65596b96efe8   fy/centos   &quot;/bin/sh -c /bin/bash&quot;   11 minutes ago   Up 11 minutes                                                          docker01</span><br><span class="line">d4a1dc5a9649   fy/centos   &quot;/bin/bash&quot;              3 hours ago      Up 3 hours                                                             elastic_yalow</span><br><span class="line">416414ce2000   mysql:5.7   &quot;docker-entrypoint.s…&quot;   5 hours ago      Up 5 hours      0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mysql01</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker attach 678cc73276ec</span><br><span class="line">[root@678cc73276ec /]# cd volume01</span><br><span class="line">[root@678cc73276ec volume01]# ls</span><br><span class="line">docker01.txt                  # docker02可以看到</span><br></pre></td></tr></table></figure>

<p><strong>创建docker03也一样同步</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker run -it --name docker03 --volumes-from docker01 fy/centos</span><br><span class="line">[root@7e9685d3fc51 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01	volume02</span><br><span class="line">[root@7e9685d3fc51 /]# cd volume01</span><br><span class="line">[root@7e9685d3fc51 volume01]# ls</span><br><span class="line">docker01.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试 可以删除docker01，查看一下docker02和docker03是否还可以访问这个文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试依旧可以访问</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230319230025675.png" alt="image-20230319230025675"></p>
<p>多个mysql实现数据共享</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw --name mysql02 --volumes-from mysql02 mysql:5.7 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个时候，可以实现两个容器数据同步！</span></span><br></pre></td></tr></table></figure>

<p>容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。但是一旦你持久化到了本地，这个时候，本地的数据是不会删除的!</p>
<h2 id="6-DockerFile"><a href="#6-DockerFile" class="headerlink" title="6. DockerFile"></a>6. DockerFile</h2><h3 id="6-1-DockerFile的介绍"><a href="#6-1-DockerFile的介绍" class="headerlink" title="6.1 DockerFile的介绍"></a>6.1 DockerFile的介绍</h3><p>dockerfile是用来构建docker镜像的文件！命令参数脚本！</p>
<p>构建步骤：</p>
<p>1、编写一个dockerfile文件</p>
<p>2、docker build构建成为一个镜像</p>
<p>3、docker run运行镜像</p>
<p>4、docker push 发布镜像（DockerHub、阿里云镜像仓库！）</p>
<p>查看一下官方是怎么做的:</p>
<p><img src="/2022/12/02/docker/image-20230326153637538.png" alt="image-20230326153637538"></p>
<p>跳转到了</p>
<p><img src="/2022/12/02/docker/image-20230326153720179.png" alt="image-20230326153720179"></p>
<p>很多官方的镜像都是基础包，很多功能没有，我们通常会自己来搭建自己的镜像。</p>
<p>官方既然可以制作镜像，那我们也可以！</p>
<h3 id="6-2-Docker的构建过程"><a href="#6-2-Docker的构建过程" class="headerlink" title="6.2 Docker的构建过程"></a>6.2 Docker的构建过程</h3><p><strong>基础知识：</strong></p>
<p>1、每个保留关键字（指令）都是必须是大写字母</p>
<p>2、执行从上到下顺序执行</p>
<p>3、#表示注释</p>
<p>4、每一个指令都会创建提交一个新的镜像曾，并提交。</p>
<p><img src="/2022/12/02/docker/image-20230326154355920.png" alt="image-20230326154355920"></p>
<p>dockerfile是面向开发的，我们以后发布项目，做镜像，就需要编写dockerfile文件，这个文件十分简单！</p>
<p>Docker镜像逐渐成为了企业交付的标准，必须要掌握！</p>
<p>步骤：开发，部署，上线，运维。。。缺一不可</p>
<p>DockerFile:构建文件，定义了一切的步骤，源代码</p>
<p>DockerImages：通过DockerFile构建生成的一个镜像，最终发布和运行的产品，原来是jar，war。</p>
<p>Docker容器：容器就是镜像运行起来提供服务的。</p>
<p>后两项是使用别人的，我们现在需要构建前两项。</p>
<h3 id="6-3-DockerFile的指令"><a href="#6-3-DockerFile的指令" class="headerlink" title="6.3 DockerFile的指令"></a>6.3 DockerFile的指令</h3><p><img src="/2022/12/02/docker/image-20230326175951196.png" alt="image-20230326175951196"></p>
<p>以前的话我们是使用别人的，现在我们知道这些指令之后，我们来练习自己写一个镜像！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM			# 基础镜像，一切从这里开始构建</span><br><span class="line">MAINTATINER 	# 镜像是谁写的：姓名+邮箱</span><br><span class="line">RUN				# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD				# 步骤，tomcat镜像，这个tomcat压缩包！添加内容。</span><br><span class="line">WORKDIR			# 镜像的工作目录	/bin/bash</span><br><span class="line">VOLUME			# 挂载的目录</span><br><span class="line">EXPOST			# 保留端口配置</span><br><span class="line">CMD				# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被代替。（替换）CMD会被docker run后面的参数替换</span><br><span class="line">ENTRYPOINT		# 指定这个容器启动的时候要运行的命令，可以追加命令				 （追加）</span><br><span class="line">ONBUILD			# 当构建一个被继承DockerFile这个时候就会运行ONBUILD的指令，触发指令。</span><br><span class="line">COPY			# 类似ADD，将我们的文件拷贝到镜像中</span><br><span class="line">ENV				# 构建的时候设置环境变量！</span><br></pre></td></tr></table></figure>

<h3 id="6-4-实战应用"><a href="#6-4-实战应用" class="headerlink" title="6.4 实战应用"></a>6.4 实战应用</h3><p>DockerHub中99%的镜像都是从基础镜像过来的FROM scratch，然后配置需要的软件和配置来构建的。</p>
<p><img src="/2022/12/02/docker/image-20230326203434034.png" alt="image-20230326203434034"></p>
<blockquote>
<p>创建一个自己的centos</p>
</blockquote>
<p><img src="/2022/12/02/docker/image-20230326205251418.png" alt="image-20230326205251418"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、编写自己的Dockerfile的文件</span></span><br><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER fy&lt;782666046@qq.com&gt;</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、 构建我们的项目</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# cat mydockerfile-centos </span><br><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER fy&lt;782666046@qq.com&gt;</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash">  命令 docker build -f dockerfile文件路径 -t 镜像名:[tag]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  docker build -f mydockerfile-centos -t mycentos:0.1 .</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line">[+] Building 59.1s (8/8) FINISHED                                                                                                                                                                                 </span><br><span class="line"> =&gt; [internal] load build definition from mydockerfile-centos                                                                                                                                                0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 249B                                                                                                                                                                         0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                                                                                            0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                                                                                              0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:7                                                                                                                                                 16.1s</span><br><span class="line"> =&gt; [1/4] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                                                                                           10.8s</span><br><span class="line"> =&gt; =&gt; resolve docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                                                                                            0.0s</span><br><span class="line"> =&gt; =&gt; sha256:2d473b07cdd5f0912cd6f1a703352c82b512407db6b05b43f2553732b55df3bc 76.10MB / 76.10MB                                                                                                             6.9s</span><br><span class="line"> =&gt; =&gt; sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987 1.20kB / 1.20kB                                                                                                               0.0s</span><br><span class="line"> =&gt; =&gt; sha256:dead07b4d8ed7e29e98de0f4504d87e8880d4347859d839686a31da35a3b532f 529B / 529B                                                                                                                   0.0s</span><br><span class="line"> =&gt; =&gt; sha256:eeb6ee3f44bd0b5103bb561b4c16bcb82328cfe5809ab675bb17ab3a16c517c9 2.75kB / 2.75kB                                                                                                               0.0s</span><br><span class="line"> =&gt; =&gt; extracting sha256:2d473b07cdd5f0912cd6f1a703352c82b512407db6b05b43f2553732b55df3bc                                                                                                                    3.6s</span><br><span class="line"> =&gt; [2/4] WORKDIR /usr/local                                                                                                                                                                                 1.1s</span><br><span class="line"> =&gt; [3/4] RUN yum -y install vim                                                                                                                                                                            24.7s</span><br><span class="line"> =&gt; [4/4] RUN yum -y install net-tools                                                                                                                                                                       5.0s</span><br><span class="line"> =&gt; exporting to image                                                                                                                                                                                       1.5s </span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                                                                                      1.5s </span><br><span class="line"> =&gt; =&gt; writing image sha256:99feb15e4be3418fafe3ddeb4d1b05b76f73e5964f8286eda897f327766f1e43                                                                                                                 0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/mycentos:0.1                                                                                                                                                              0.0s</span><br><span class="line"> </span><br><span class="line"><span class="meta"> #</span><span class="bash">3、测试运行 到了默认的工作目录地方</span></span><br><span class="line"> [root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run -it mycentos:0.1</span><br><span class="line">[root@ac45d7309e36 local]# pwd</span><br><span class="line">/usr/local</span><br><span class="line"><span class="meta">#</span><span class="bash"> 官方的默认的工作目录的根目录，我们增加之后的镜像添加了vim和ifconfig等操作</span></span><br></pre></td></tr></table></figure>

<p><strong>通过docker history查看镜像如何构建出来的</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">mycentos              0.1       99feb15e4be3   10 minutes ago   639MB</span><br><span class="line">tomcat02              1.0.1     ab5a6c1fa1ce   7 days ago       685MB</span><br><span class="line">nginx                 latest    605c77e624dd   15 months ago    141MB</span><br><span class="line">tomcat                9.0       b8e65a4d736d   15 months ago    680MB</span><br><span class="line">redis                 latest    7614ae9453d1   15 months ago    113MB</span><br><span class="line">mysql                 5.7       c20987f18b13   15 months ago    448MB</span><br><span class="line">fy/centos             latest    ee0550ee2678   18 months ago    231MB</span><br><span class="line">centos                latest    5d0da3dc9764   18 months ago    231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   2 years ago      79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   3 years ago      791MB</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker history 99feb15e4be3</span><br><span class="line">IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT</span><br><span class="line">99feb15e4be3   10 minutes ago   CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin/bash&quot;]                0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo \&quot;---end---\&quot;&quot;]       0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo $MYPATH&quot;]             0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   EXPOSE map[80/tcp:&#123;&#125;]                           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   RUN /bin/sh -c yum -y install net-tools # bu…   176MB     buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   RUN /bin/sh -c yum -y install vim # buildkit    259MB     buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   WORKDIR /usr/local                              0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   ENV MYPATH=/usr/local                           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      10 minutes ago   MAINTAINER fy&lt;782666046@qq.com&gt;                 0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      18 months ago    /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        </span><br><span class="line">&lt;missing&gt;      18 months ago    /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        </span><br><span class="line">&lt;missing&gt;      18 months ago    /bin/sh -c #(nop) ADD file:b3ebbe8bd304723d4…   204MB </span><br></pre></td></tr></table></figure>

<blockquote>
<p>CMD 和 ENTRYPOINT的区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENTRYPOINT		# 指定这个容器启动的时候要运行的命令，可以追加命令				 （追加）</span><br><span class="line">ONBUILD			# 当构建一个被继承DockerFile这个时候就会运行ONBUILD的指令，触发指令。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> CMD 命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编写dockerfile文件</span></span><br><span class="line">FROM centos:7</span><br><span class="line">CMD [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建镜像</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker build -f dockerfile-cmd-test -t cmdtest .</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# ls</span><br><span class="line">dockerfile-cmd-test  mydockerfile-centos</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mycentos              0.1       99feb15e4be3   25 hours ago    639MB</span><br><span class="line">tomcat02              1.0.1     ab5a6c1fa1ce   8 days ago      685MB</span><br><span class="line">nginx                 latest    605c77e624dd   15 months ago   141MB</span><br><span class="line">tomcat                9.0       b8e65a4d736d   15 months ago   680MB</span><br><span class="line">redis                 latest    7614ae9453d1   15 months ago   113MB</span><br><span class="line">mysql                 5.7       c20987f18b13   15 months ago   448MB</span><br><span class="line">cmdtest               latest    d53776618e7c   18 months ago   204MB</span><br><span class="line">fy/centos             latest    ee0550ee2678   18 months ago   231MB</span><br><span class="line">centos                latest    5d0da3dc9764   18 months ago   231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   2 years ago     79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   3 years ago     791MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> run运行，发现我们的ls -a 命令生效</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run d53776618e7c</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">anaconda-post.log</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta">#</span><span class="bash"> 想追加一个命令 -l ls -al</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run d53776618e7c -l</span><br><span class="line">docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line">ERRO[0000] error waiting for container:</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cmd的清理下 -l替换了CMD[<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]命令，-l不是命令所以报错！</span></span><br><span class="line">添加ls -a可得到</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run d53776618e7c ls -al</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x   1 root root  4096 Mar 27 14:33 .</span><br><span class="line">drwxr-xr-x   1 root root  4096 Mar 27 14:33 ..</span><br><span class="line">-rwxr-xr-x   1 root root     0 Mar 27 14:33 .dockerenv</span><br><span class="line">-rw-r--r--   1 root root 12114 Nov 13  2020 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root   340 Mar 27 14:33 dev</span><br><span class="line">drwxr-xr-x   1 root root  4096 Mar 27 14:33 etc</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 home</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root     9 Nov 13  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 media</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 mnt</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 opt</span><br><span class="line">dr-xr-xr-x 116 root root     0 Mar 27 14:33 proc</span><br><span class="line">dr-xr-x---   2 root root  4096 Nov 13  2020 root</span><br><span class="line">drwxr-xr-x  11 root root  4096 Nov 13  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root     8 Nov 13  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 srv</span><br><span class="line">dr-xr-xr-x  13 root root     0 Mar 19 11:11 sys</span><br><span class="line">drwxrwxrwt   7 root root  4096 Nov 13  2020 tmp</span><br><span class="line">drwxr-xr-x  13 root root  4096 Nov 13  2020 usr</span><br><span class="line">drwxr-xr-x  18 root root  4096 Nov 13  2020 var</span><br></pre></td></tr></table></figure>

<p><strong>entrypoint</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mycentos              0.1       99feb15e4be3   26 hours ago    639MB</span><br><span class="line">tomcat02              1.0.1     ab5a6c1fa1ce   8 days ago      685MB</span><br><span class="line">nginx                 latest    605c77e624dd   15 months ago   141MB</span><br><span class="line">tomcat                9.0       b8e65a4d736d   15 months ago   680MB</span><br><span class="line">redis                 latest    7614ae9453d1   15 months ago   113MB</span><br><span class="line">mysql                 5.7       c20987f18b13   15 months ago   448MB</span><br><span class="line">entrypointtest        latest    dbcf4f99ed1c   18 months ago   204MB</span><br><span class="line">cmdtest               latest    d53776618e7c   18 months ago   204MB</span><br><span class="line">fy/centos             latest    ee0550ee2678   18 months ago   231MB</span><br><span class="line">centos                latest    5d0da3dc9764   18 months ago   231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   2 years ago     79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   3 years ago     791MB</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run dbcf4f99ed1c</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">anaconda-post.log</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run dbcf4f99ed1c -l</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x   1 root root  4096 Mar 27 14:36 .</span><br><span class="line">drwxr-xr-x   1 root root  4096 Mar 27 14:36 ..</span><br><span class="line">-rwxr-xr-x   1 root root     0 Mar 27 14:36 .dockerenv</span><br><span class="line">-rw-r--r--   1 root root 12114 Nov 13  2020 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root   340 Mar 27 14:36 dev</span><br><span class="line">drwxr-xr-x   1 root root  4096 Mar 27 14:36 etc</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 home</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root     9 Nov 13  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 media</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 mnt</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 opt</span><br><span class="line">dr-xr-xr-x 114 root root     0 Mar 27 14:36 proc</span><br><span class="line">dr-xr-x---   2 root root  4096 Nov 13  2020 root</span><br><span class="line">drwxr-xr-x  11 root root  4096 Nov 13  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root     8 Nov 13  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 srv</span><br><span class="line">dr-xr-xr-x  13 root root     0 Mar 19 11:11 sys</span><br><span class="line">drwxrwxrwt   7 root root  4096 Nov 13  2020 tmp</span><br><span class="line">drwxr-xr-x  13 root root  4096 Nov 13  2020 usr</span><br><span class="line">drwxr-xr-x  18 root root  4096 Nov 13  2020 var</span><br></pre></td></tr></table></figure>

<p>dockerfile中许多命令都十分的相似，我们需要了解他们的区别，练习然后对比。</p>
<h3 id="6-5-实战-Tomcat镜像"><a href="#6-5-实战-Tomcat镜像" class="headerlink" title="6.5 实战:Tomcat镜像"></a>6.5 实战:Tomcat镜像</h3><p>1、准备tomcat压缩包，jdk的压缩包！</p>
<p><img src="/2022/12/02/docker/image-20230327231458465.png" alt="image-20230327231458465"></p>
<p>2、编写dockerfile的文件, 官方命名为<strong>Dockerfile</strong>，build会自动寻找这个文件，就不需要-f指定了！</p>
<p><img src="/2022/12/02/docker/image-20230327231507829.png" alt="image-20230327231507829"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER feiyang&lt;782666046@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u361-linux-i586.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.73.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install glibc.i686</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_361</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.73</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.73</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.73/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.73/bin/logs/catalina.out</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、构建镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker build -t diytomcat .</span></span><br><span class="line"></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ java_tomcat]# docker build -t diytomcat .</span><br><span class="line">[+] Building 56.2s (11/11) FINISHED                                                                                                                                                                               </span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                                                                                                         0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 682B                                                                                                                                                                         0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                                                                                            0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                                                                                              0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:7                                                                                                                                                 15.3s</span><br><span class="line"> =&gt; CACHED [1/6] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                                                                                     0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                                                                                                            1.3s</span><br><span class="line"> =&gt; =&gt; transferring context: 153.61MB                                                                                                                                                                        1.3s</span><br><span class="line"> =&gt; [2/6] COPY readme.txt /usr/local/readme.txt                                                                                                                                                              1.0s</span><br><span class="line"> =&gt; [3/6] ADD jdk-8u361-linux-i586.tar.gz /usr/local/                                                                                                                                                        5.8s</span><br><span class="line"> =&gt; [4/6] ADD apache-tomcat-9.0.73.tar.gz /usr/local/                                                                                                                                                        0.6s</span><br><span class="line"> =&gt; [5/6] RUN yum -y install vim                                                                                                                                                                            26.6s</span><br><span class="line"> =&gt; [6/6] WORKDIR /usr/local                                                                                                                                                                                 0.1s </span><br><span class="line"> =&gt; exporting to image                                                                                                                                                                                       5.3s </span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                                                                                      5.2s </span><br><span class="line"> =&gt; =&gt; writing image sha256:0cff28b837abbbd1164bc0624f26425bbc8faa6468c3ae2bc9b2e70ea960b005                                                                                                                 0.1s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/diytomcat                                                                                                                                                                 0.0s </span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ java_tomcat]# docker images                                                                                                                                                         </span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">diytomcat             latest    0cff28b837ab   15 seconds ago   822MB</span><br><span class="line">mycentos              0.1       99feb15e4be3   27 hours ago     639MB</span><br><span class="line">tomcat02              1.0.1     ab5a6c1fa1ce   8 days ago       685MB</span><br><span class="line">nginx                 latest    605c77e624dd   15 months ago    141MB</span><br><span class="line">tomcat                9.0       b8e65a4d736d   15 months ago    680MB</span><br><span class="line">redis                 latest    7614ae9453d1   15 months ago    113MB</span><br><span class="line">mysql                 5.7       c20987f18b13   15 months ago    448MB</span><br><span class="line">entrypointtest        latest    dbcf4f99ed1c   18 months ago    204MB</span><br><span class="line">cmdtest               latest    d53776618e7c   18 months ago    204MB</span><br><span class="line">fy/centos             latest    ee0550ee2678   18 months ago    231MB</span><br><span class="line">centos                latest    5d0da3dc9764   18 months ago    231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   2 years ago      79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   3 years ago      791MB</span><br></pre></td></tr></table></figure>

<p><strong>启动镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9090:8080 --name fytomcat -v /home/fy/build/tomcat/test/:/usr/local/apache-tomcat-9.0.73/webapps/test -v /home/fy/build/tomcat/tocatlogs/:/usr/local/apache-tomcat-9.0.73/logs diytomcat</span><br></pre></td></tr></table></figure>

<p><strong>访问测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9090</span><br></pre></td></tr></table></figure>

<p><strong>发布项目（由于做了卷挂载，我们直接在本地编写项目就可以了）</strong></p>
<p>直接在本地的test文件夹下创建WEB-INF目录，创建web.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WEB-INF</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ test]# cd WEB-INF/</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ WEB-INF]# vim web.xml</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;</span><br><span class="line">    xmlns:web=&quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span><br><span class="line">    id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<p>创建index.jsp</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Hello World!&lt;br/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">System.out.println(&quot;Your IP address is &quot; + request.getRemoteAddr());</span><br><span class="line"><span class="meta">%</span><span class="bash">&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>访问/test</p>
<p>发现:项目部署成功，可以直接访问ok!</p>
<p>我们以后开发的步骤：需要掌握Dockerfile的编写！我们之后的一切都是使用docker镜像来发布运行的！</p>
<h3 id="6-6-发布自己的镜像"><a href="#6-6-发布自己的镜像" class="headerlink" title="6.6 发布自己的镜像"></a>6.6 发布自己的镜像</h3><blockquote>
<p> DockerHub</p>
</blockquote>
<ol>
<li>地址<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a> 注册自己的账号。</li>
<li>确定这个账号可以登录。</li>
<li>在我们的服务器上提交自己的镜像。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>登陆完毕后就可以提交镜像了，就是一步docker push命令</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker login -u huangfeiyang </span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>docker tag 远程名字加标签</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker push diytomcat</span><br><span class="line">Using default tag: latest</span><br><span class="line">The push refers to repository [docker.io/library/diytomcat]</span><br><span class="line">5f70bf18a086: Preparing </span><br><span class="line">a511f1209eca: Preparing </span><br><span class="line">e57425c951f6: Preparing </span><br><span class="line">eef9362ecea1: Preparing </span><br><span class="line">db1d44768016: Preparing </span><br><span class="line">c147dfec7a0e: Waiting </span><br><span class="line">174f56854903: Waiting </span><br><span class="line">denied: requested access to the resource is denied  # 被拒绝了</span><br><span class="line"><span class="meta">#</span><span class="bash"> 增加tag，tag必须是 用户名/标签，因为是私人仓库，所以开头必须是用户名。</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker tag 78218c4c328c huangfeiyang/diytomcat:1.0</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ /]# docker push huangfeiyang/diytomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/huangfeiyang/diytomcat]</span><br><span class="line">5f70bf18a086: Pushed </span><br><span class="line">a511f1209eca: Pushing [=&gt;                                                 ]  8.077MB/217.3MB</span><br><span class="line">e57425c951f6: Pushing [&gt;                                                  ]  4.916MB/259.1MB</span><br><span class="line">eef9362ecea1: Pushing [========&gt;                                          ]  2.884MB/16.17MB</span><br><span class="line">db1d44768016: Pushing [&gt;                                                  ]  3.316MB/342.4MB</span><br><span class="line">c147dfec7a0e: Pushed </span><br><span class="line">174f56854903: Pushing [=&gt;                                                 ]  4.875MB/203.9MB</span><br></pre></td></tr></table></figure>

<blockquote>
<p>阿里云镜像服务上</p>
</blockquote>
<p>1、登录阿里云</p>
<p>2、找到容器镜像服务</p>
<p>3、创建命名空间</p>
<p><img src="/2022/12/02/docker/image-20230329000115832.png" alt="image-20230329000115832"></p>
<p>4、创建容器镜像</p>
<p><img src="/2022/12/02/docker/image-20230329000110612.png" alt="image-20230329000110612"></p>
<p>5、</p>
<p><img src="/2022/12/02/docker/image-20230329000205809.png" alt="image-20230329000205809"></p>
<p>在这里可以找到</p>
<p><img src="/2022/12/02/docker/image-20230329000529071.png" alt="image-20230329000529071"></p>
<h3 id="6-7-Docker的所有流程小结"><a href="#6-7-Docker的所有流程小结" class="headerlink" title="6.7 Docker的所有流程小结"></a>6.7 Docker的所有流程小结</h3><p><img src="/2022/12/02/docker/image-20230329224842090.png" alt="image-20230329224842090"></p>
<p><strong>docker save 存在本地成为tar</strong></p>
<p><strong>docker load 将tar加载成为镜像</strong></p>
<h2 id="7-Docker网络"><a href="#7-Docker网络" class="headerlink" title="7. Docker网络"></a>7. Docker网络</h2><h3 id="7-1-理解Docker网络"><a href="#7-1-理解Docker网络" class="headerlink" title="7.1 理解Docker网络"></a>7.1 理解Docker网络</h3><p>首先清空所有环境。</p>
<p><strong>查看容器内部网络地址 ip addr 命令</strong></p>
<blockquote>
<p>测试</p>
</blockquote>
<p><img src="/2022/12/02/docker/image-20230330160159171.png" alt="image-20230330160159171"></p>
<p>三个网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 问题， docker是如何处理容器网络访问的。</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230331202446893.png" alt="image-20230331202446893"></p>
<p> <strong>yum -y install initscripts 安装ip addr命令</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run -P --name iptest01 -it ip-test-centos:0.1  /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器内部的网络地址 ip addr， 发现容器启动的时候会得到一个 eth0@if123 ip地址的，docker分配的！</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it iptest01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">122: eth0@if123: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta">#</span><span class="bash">思考。Linux服务器能不能ping通容器内部！测试发现可以ping通！</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.046 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.042 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.044 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=5 ttl=64 time=0.045 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=6 ttl=64 time=0.053 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=7 ttl=64 time=0.049 ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<p>192.168.0.1 路由器的地址</p>
<p><strong>1、我们每启动一个docker容器，docker就会给docker容器ip，我们只要安装了docker就会有一个网卡，叫做网卡docker0。</strong></p>
<p>桥接模式，使用的技术是evth-pair技术！</p>
<p>再次测试ip addr发现多了</p>
<p><img src="/2022/12/02/docker/image-20230331203659894.png" alt="image-20230331203659894"></p>
<p><strong>2、再启动一个容器测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run -P --name iptest02 -it ip-test-centos:0.1  /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果 又多了一个125 124组合，即又多了一对网卡</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:01:72:a0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.42.182/20 brd 172.19.47.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314158409sec preferred_lft 314158409sec</span><br><span class="line">    inet6 fe80::216:3eff:fe01:72a0/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:74:bf:2e:bb brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:74ff:febf:2ebb/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">123: vethf50b127@if122: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 6a:03:e8:1c:ed:f1 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::6803:e8ff:fe1c:edf1/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:01:72:a0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.42.182/20 brd 172.19.47.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314158293sec preferred_lft 314158293sec</span><br><span class="line">    inet6 fe80::216:3eff:fe01:72a0/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:74:bf:2e:bb brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:74ff:febf:2ebb/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">123: vethf50b127@if122: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 6a:03:e8:1c:ed:f1 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::6803:e8ff:fe1c:edf1/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">125: veth74d2492@if124: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether a2:8f:42:b7:0b:be brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::a08f:42ff:feb7:bbe/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>再次在02里面执行ip addr 发现还是成对的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it iptest02 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">124: eth0@if125: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们发现这个容器带来的网卡，都是一对一对的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> evth-pair就是一对虚拟设备接口，他们都是成对出现的，一段连着协议，一段彼此相连</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正是因为这个特性，evth-pair充当一个桥梁，连接各种虚拟网络设备。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> OpenStac，Docker容器之间的连接，OVS的连接，都是使用evth-pair技术</span></span><br></pre></td></tr></table></figure>

<p><strong>3、我们来测试一下01和02之间是否能ping通，发现可以互通。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it iptest02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.135 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.054 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.068 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器和容器之间是可以互相ping通的。</span></span><br></pre></td></tr></table></figure>

<p>绘制一个网络模型图。</p>
<p><img src="/2022/12/02/docker/image-20230331205142877.png" alt="image-20230331205142877"></p>
<p>结论 01和02是公用一个路由器，docker0，所有容器不指定网络的情况下都是用docker0路由的，docker会给我们的容器分配一个默认的可用的IP。</p>
<p>255.255.0.1/16 域，局域网！</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>docker使用的是Linux的桥接技术，宿主机中是一个Docker容器的网桥。</p>
<p><img src="/2022/12/02/docker/image-20230331205548935.png" alt="image-20230331205548935"></p>
<p>Docker中所有的网络接口都是虚拟的。虚拟转发的效率非常高！（内网传递文件！）</p>
<p><strong>只要容器删除，对应的网桥一对就没了。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND       CREATED          STATUS          PORTS                                     NAMES</span><br><span class="line">3b36f34b754c   ip-test-centos:0.1   &quot;/bin/bash&quot;   18 minutes ago   Up 18 minutes   0.0.0.0:32772-&gt;80/tcp, :::32772-&gt;80/tcp   iptest02</span><br><span class="line">c031e4637925   ip-test-centos:0.1   &quot;/bin/bash&quot;   35 minutes ago   Up 35 minutes   0.0.0.0:32771-&gt;80/tcp, :::32771-&gt;80/tcp   iptest01</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker rm -f iptest02</span><br><span class="line">iptest02</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND       CREATED          STATUS          PORTS                                     NAMES</span><br><span class="line">c031e4637925   ip-test-centos:0.1   &quot;/bin/bash&quot;   35 minutes ago   Up 35 minutes   0.0.0.0:32771-&gt;80/tcp, :::32771-&gt;80/tcp   iptest01</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:01:72:a0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.42.182/20 brd 172.19.47.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314157174sec preferred_lft 314157174sec</span><br><span class="line">    inet6 fe80::216:3eff:fe01:72a0/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:74:bf:2e:bb brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:74ff:febf:2ebb/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">123: vethf50b127@if122: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 6a:03:e8:1c:ed:f1 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::6803:e8ff:fe1c:edf1/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230331210835080.png" alt="image-20230331210835080"></p>
<p><strong>–link命令</strong></p>
<blockquote>
<p>思考一个场景，我们编写了一个微服务，database_url=ip:，项目不重启，数据库ip换了，我们希望可以处理这个问题，可以通过名字来访问容器？</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 直接用服务名无法ping通</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND       CREATED          STATUS          PORTS                                     NAMES</span><br><span class="line">58c789ac2065   ip-test-centos:0.1   &quot;/bin/bash&quot;   7 seconds ago    Up 7 seconds    0.0.0.0:32773-&gt;80/tcp, :::32773-&gt;80/tcp   iptest02</span><br><span class="line">c031e4637925   ip-test-centos:0.1   &quot;/bin/bash&quot;   38 minutes ago   Up 38 minutes   0.0.0.0:32771-&gt;80/tcp, :::32771-&gt;80/tcp   iptest01</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it iptest02 ping iptest01</span><br><span class="line">ping: iptest01: Name or service not known</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如何可以解决呢？</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run -d -P --name iptest03 --link iptest02 -it ip-test-centos:0.1 /bin/bash </span><br><span class="line">9e75e119330c645faf1271654b975b78f171743325a378587959024fca3dd935</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND       CREATED          STATUS          PORTS                                     NAMES</span><br><span class="line">9e75e119330c   ip-test-centos:0.1   &quot;/bin/bash&quot;   4 seconds ago    Up 3 seconds    0.0.0.0:32776-&gt;80/tcp, :::32776-&gt;80/tcp   iptest03</span><br><span class="line">58c789ac2065   ip-test-centos:0.1   &quot;/bin/bash&quot;   4 minutes ago    Up 4 minutes    0.0.0.0:32773-&gt;80/tcp, :::32773-&gt;80/tcp   iptest02</span><br><span class="line">c031e4637925   ip-test-centos:0.1   &quot;/bin/bash&quot;   42 minutes ago   Up 42 minutes   0.0.0.0:32771-&gt;80/tcp, :::32771-&gt;80/tcp   iptest01</span><br><span class="line"><span class="meta">#</span><span class="bash"> 发现可以用名字ping通了</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it iptest03 ping iptest02</span><br><span class="line">PING iptest02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from iptest02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from iptest02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.067 ms</span><br><span class="line"><span class="meta">#</span><span class="bash"> 反向可以ping通吗？不可以</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it iptest02 ping iptest03</span><br><span class="line">ping: iptest03: Name or service not known</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230331210859426.png" alt="image-20230331210859426"></p>
<p><strong>docker inspect iptest03</strong></p>
<p><img src="/2022/12/02/docker/image-20230331211341185.png" alt="image-20230331211341185"></p>
<p><strong>查看03 host 配置 docker exec -it iptest03 cat /etc/hosts</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 发现存在iptest02的映射</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it iptest03 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	iptest02 58c789ac2065</span><br><span class="line">172.17.0.4	9e75e119330c</span><br></pre></td></tr></table></figure>

<p>本质探究： –link命令就是我们在hosts配置中增加了一个172.18.0.3  iptest02 58c789ac2065</p>
<p>我们现在使用Docker已经不建议使用–link了！</p>
<p>自定义网络！ 不使用docker0</p>
<p>docker0的问题：不支持容器名连接访问！</p>
<h3 id="7-2-自定义网络"><a href="#7-2-自定义网络" class="headerlink" title="7.2 自定义网络"></a>7.2 自定义网络</h3><blockquote>
<p>查看所有的docker网络</p>
</blockquote>
<p><img src="/2022/12/02/docker/image-20230331211731990.png" alt="image-20230331211731990"></p>
<p>网络模式</p>
<p>bridge 桥接模式 在docker上搭桥（默认，自己创建也使用bridge桥接模式）</p>
<p>none：不配置网络</p>
<p>host：和宿主机共享网络</p>
<p>container：容器内网络连通！（用的少！）</p>
<p><strong>测试</strong>，测试前先删除所有容器，ip addr看到还原</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker rm -f $(docker ps -aq)</span><br><span class="line">9e75e119330c</span><br><span class="line">58c789ac2065</span><br><span class="line">c031e4637925</span><br><span class="line">c3eaf974a18f</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:01:72:a0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.42.182/20 brd 172.19.47.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314155819sec preferred_lft 314155819sec</span><br><span class="line">    inet6 fe80::216:3eff:fe01:72a0/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:74:bf:2e:bb brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:74ff:febf:2ebb/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们直接启动的命令， --net bridge， 而这个就是我们的docker0</span></span><br><span class="line">docker run -d -P --name iptest01 -it ip-test-centos:0.1 /bin/bash</span><br><span class="line">docker run -d -P --name iptest01 --net bridge -it ip-test-centos:0.1 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker0的特点，默认，域名不能访问，--link可以打通连接。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看create的官方文档</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker network create --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network create [OPTIONS] NETWORK</span><br><span class="line"></span><br><span class="line">Create a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --attachable           Enable manual container attachment</span><br><span class="line">      --aux-address map      Auxiliary IPv4 or IPv6 addresses used by Network driver (default map[])</span><br><span class="line">      --config-from string   The network from which to copy the configuration</span><br><span class="line">      --config-only          Create a configuration only network</span><br><span class="line">  -d, --driver string        Driver to manage the Network (default &quot;bridge&quot;)</span><br><span class="line">      --gateway strings      IPv4 or IPv6 Gateway for the master subnet</span><br><span class="line">      --ingress              Create swarm routing-mesh network</span><br><span class="line">      --internal             Restrict external access to the network</span><br><span class="line">      --ip-range strings     Allocate container ip from a sub-range</span><br><span class="line">      --ipam-driver string   IP Address Management Driver (default &quot;default&quot;)</span><br><span class="line">      --ipam-opt map         Set IPAM driver specific options (default map[])</span><br><span class="line">      --ipv6                 Enable IPv6 networking</span><br><span class="line">      --label list           Set metadata on a network</span><br><span class="line">  -o, --opt map              Set driver specific options (default map[])</span><br><span class="line">      --scope string         Control the network&#x27;s scope</span><br><span class="line">      --subnet strings       Subnet in CIDR format that represents a network segment</span><br></pre></td></tr></table></figure>

<p>创建我们自定义网络的子网</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们可以自定义一个网络</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --driver bridge</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --subnet 192.168.0.0/16 可以分配到 192.168.255.255</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --gateway 192.168.0.1</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet </span><br><span class="line">b5e301210de33e1e757095004e5fe79aef53ee56693e40ec8cb77e7f991f2ba1</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">807ab76623e8   bridge    bridge    local</span><br><span class="line">ecf224b127fd   host      host      local</span><br><span class="line">b5e301210de3   mynet     bridge    local</span><br><span class="line">2b4f9b9108b7   none      null      local</span><br></pre></td></tr></table></figure>

<p>查看我们自己配置的网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;b5e301210de33e1e757095004e5fe79aef53ee56693e40ec8cb77e7f991f2ba1&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2023-03-31T21:24:36.366707573+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>利用我们自己定义的网络创建容器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run -d -P --name net-test-01 --net mynet -it ip-test-centos:0.1 &#x2F;bin&#x2F;bash </span><br><span class="line">40e7be9190a7104ae320aff65667400ec461301cc94279a8605ba81fb69549a7</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND       CREATED         STATUS         PORTS                                     NAMES</span><br><span class="line">40e7be9190a7   ip-test-centos:0.1   &quot;&#x2F;bin&#x2F;bash&quot;   2 seconds ago   Up 2 seconds   0.0.0.0:32777-&gt;80&#x2F;tcp, :::32777-&gt;80&#x2F;tcp   net-test-01</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run -d -P --name net-test-02 --net mynet -it ip-test-centos:0.1 &#x2F;bin&#x2F;bash </span><br><span class="line">59f4a8c93e5528e884adef76978760add1ffdbe2d548bb2c6f9d8526ff54cf03</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND       CREATED          STATUS          PORTS                                     NAMES</span><br><span class="line">59f4a8c93e55   ip-test-centos:0.1   &quot;&#x2F;bin&#x2F;bash&quot;   3 seconds ago    Up 2 seconds    0.0.0.0:32778-&gt;80&#x2F;tcp, :::32778-&gt;80&#x2F;tcp   net-test-02</span><br><span class="line">40e7be9190a7   ip-test-centos:0.1   &quot;&#x2F;bin&#x2F;bash&quot;   16 seconds ago   Up 15 seconds   0.0.0.0:32777-&gt;80&#x2F;tcp, :::32777-&gt;80&#x2F;tcp   net-test-01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>再查看网络</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;b5e301210de33e1e757095004e5fe79aef53ee56693e40ec8cb77e7f991f2ba1&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2023-03-31T21:24:36.366707573+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;40e7be9190a7104ae320aff65667400ec461301cc94279a8605ba81fb69549a7&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;net-test-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;8710256745df8fa6ecd45463005118d7dd57f05a4808db15f4e93445e2f80d6c&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;59f4a8c93e5528e884adef76978760add1ffdbe2d548bb2c6f9d8526ff54cf03&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;net-test-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;e0b593335f1fa9949581bc67dbfeb34caa5b8ec64200e2a61efb00a7e5aea7c8&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 发现我们自定义的网络，利用ip和名字01都能ping通02</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 现在不使用--link都可以ping 名字了</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it net-test-01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.078 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.060 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.060/0.069/0.078/0.009 ms</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it net-test-01 ping net-test-02</span><br><span class="line">PING net-test-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from net-test-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from net-test-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.066 ms</span><br></pre></td></tr></table></figure>

<p>我们自定义的网络docker都已经帮我们维护好了对应的关系，推荐我们平时这样使用网络！</p>
<p>好处：</p>
<p>redis - 不同的集群使用不同的网络，保证集群是安全和健康的</p>
<p>mysql - 不同的集群使用不同的网络，保证集群是安全和健康的</p>
<p><img src="/2022/12/02/docker/image-20230331213417574.png" alt="image-20230331213417574"></p>
<h3 id="7-3-网络连通"><a href="#7-3-网络连通" class="headerlink" title="7.3 网络连通"></a>7.3 网络连通</h3><p><img src="/2022/12/02/docker/image-20230331214413476.png" alt="image-20230331214413476"></p>
<p>利用docker0再创建两个网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run -d -P --name docker0-test-01 -it ip-test-centos:0.1 /bin/bash </span><br><span class="line">40a9c26c4b50b08ac75ff9001866ee68487db76ca533e520d5f9038691c567b3</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker run -d -P --name docker0-test-02 -it ip-test-centos:0.1 /bin/bash </span><br><span class="line">852b37d4c3801f4c896753cbfaf9b849652e85acffccdfc08f09aaa6d2d0bc39</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                COMMAND       CREATED         STATUS         PORTS                                     NAMES</span><br><span class="line">852b37d4c380   ip-test-centos:0.1   &quot;/bin/bash&quot;   1 second ago    Up 1 second    0.0.0.0:32780-&gt;80/tcp, :::32780-&gt;80/tcp   docker0-test-02</span><br><span class="line">40a9c26c4b50   ip-test-centos:0.1   &quot;/bin/bash&quot;   5 seconds ago   Up 4 seconds   0.0.0.0:32779-&gt;80/tcp, :::32779-&gt;80/tcp   docker0-test-01</span><br><span class="line">59f4a8c93e55   ip-test-centos:0.1   &quot;/bin/bash&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:32778-&gt;80/tcp, :::32778-&gt;80/tcp   net-test-02</span><br><span class="line">40e7be9190a7   ip-test-centos:0.1   &quot;/bin/bash&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:32777-&gt;80/tcp, :::32777-&gt;80/tcp   net-test-01</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230331213800033.png" alt="image-20230331213800033"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试打通docker0-test-01 到mynet</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker network connect mynet docker0-test-01</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker network inspect mynet</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打通方式！一个容器两个ip地址！</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 阿里云服务，公网ip，私网ip</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新用docker0-test-01 ping mynet下的net-test-01 发现可以ping通！</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it docker0-test-01 ping net-test-01</span><br><span class="line">PING net-test-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from net-test-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.066 ms</span><br><span class="line">64 bytes from net-test-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.063 ms</span><br><span class="line">64 bytes from net-test-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.055 ms</span><br><span class="line"><span class="meta">#</span><span class="bash"> 02 依旧打不通！</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ dockerfile]# docker exec -it docker0-test-02 ping net-test-01</span><br><span class="line">ping: net-test-01: Name or service not known</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230331214006174.png" alt="image-20230331214006174"></p>
<p>结论，假设要跨网络操作别人，就需要使用docker network connect 连通！</p>
<h3 id="7-4-部署Redis集群"><a href="#7-4-部署Redis集群" class="headerlink" title="7.4 部署Redis集群"></a>7.4 部署Redis集群</h3><p>shell脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat  &lt;&lt; EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379 </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes </span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/02/docker/image-20230331214724606.png" alt="image-20230331214724606"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ node-1]# ls</span><br><span class="line">conf</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ node-1]# cd conf&#x2F;</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ conf]# ls</span><br><span class="line">redis.conf</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ conf]# cat redis.conf </span><br><span class="line">port 6379 </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes </span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.11</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line"># 通过脚本一次启动6个redis容器</span><br><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v &#x2F;mydata&#x2F;redis&#x2F;node-$&#123;port&#125;&#x2F;data:&#x2F;data \</span><br><span class="line">-v &#x2F;mydata&#x2F;redis&#x2F;node-$&#123;port&#125;&#x2F;conf&#x2F;redis.conf:&#x2F;etc&#x2F;redis&#x2F;redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server &#x2F;etc&#x2F;redis&#x2F;redis.conf</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建redis网络</span></span><br><span class="line">docker network create --driver bridge --subnet 172.38.0.0/16 --gateway 172.38.0.1 redis</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动第一个redis</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ redis]# docker run -p 6371:6379 -p 16371:16379 --name redis-1 -v /mydata/redis/node-$&#123;port&#125;/data:/data -v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">a12e8e3841c27b7faf259e505ab9f219fad3d8d01c3466b6ccace39e45acaf3b</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ redis]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                                                                      NAMES</span><br><span class="line">a12e8e3841c2   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   3 seconds ago   Up 2 seconds   0.0.0.0:6371-&gt;6379/tcp, :::6371-&gt;6379/tcp, 0.0.0.0:16371-&gt;16379/tcp, :::16371-&gt;16379/tcp   redis-1</span><br></pre></td></tr></table></figure>

<p>启动六个集群</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ redis]# for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">done</span><br><span class="line">eea49e406a0b0b2666fba252f4fbc480702e88122fcb599e337ab46e455dae91</span><br><span class="line">e8e67c6007a234e4b38a59863cea64b525a612efffc2d302c4e37ece389726ab</span><br><span class="line">7c22ecd784d57b33ff1d30cdee529f5723e6aafa7ae13bd6efe4d988f912f7b2</span><br><span class="line">ebbd73cb5799bcafd5a5eb9d4dddc9322f5e7a0beb9eb6e4b2bde97a2fc6fbae</span><br><span class="line">e17eecce1c858ddb1ecb112e47d11674e9f44dfd42c8a66467cc4b52985d42c4</span><br><span class="line">6e59baf52688bb0cca2b71b37d5dffe087ba61c7f84c2119b69806ddc76c9c03</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ redis]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                                                                      NAMES</span><br><span class="line">6e59baf52688   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   2 seconds ago   Up 2 seconds   0.0.0.0:6376-&gt;6379/tcp, :::6376-&gt;6379/tcp, 0.0.0.0:16376-&gt;16379/tcp, :::16376-&gt;16379/tcp   redis-6</span><br><span class="line">e17eecce1c85   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   3 seconds ago   Up 2 seconds   0.0.0.0:6375-&gt;6379/tcp, :::6375-&gt;6379/tcp, 0.0.0.0:16375-&gt;16379/tcp, :::16375-&gt;16379/tcp   redis-5</span><br><span class="line">ebbd73cb5799   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   3 seconds ago   Up 3 seconds   0.0.0.0:6374-&gt;6379/tcp, :::6374-&gt;6379/tcp, 0.0.0.0:16374-&gt;16379/tcp, :::16374-&gt;16379/tcp   redis-4</span><br><span class="line">7c22ecd784d5   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   4 seconds ago   Up 3 seconds   0.0.0.0:6373-&gt;6379/tcp, :::6373-&gt;6379/tcp, 0.0.0.0:16373-&gt;16379/tcp, :::16373-&gt;16379/tcp   redis-3</span><br><span class="line">e8e67c6007a2   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   4 seconds ago   Up 4 seconds   0.0.0.0:6372-&gt;6379/tcp, :::6372-&gt;6379/tcp, 0.0.0.0:16372-&gt;16379/tcp, :::16372-&gt;16379/tcp   redis-2</span><br><span class="line">eea49e406a0b   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   5 seconds ago   Up 4 seconds   0.0.0.0:6371-&gt;6379/tcp, :::6371-&gt;6379/tcp, 0.0.0.0:16371-&gt;16379/tcp, :::16371-&gt;16379/tcp   redis-1</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: d6a1c22c527f7de1d1dc9d3c7585ae6bd6a73aaf 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: a97fe82c442665eeb3c00537a3fad7973ed07c32 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: c29901af4a69775d0803fe3d44d5d37990bd7629 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: b69ee45a1dcdd8ac7f9c29005c26b47dc178e2a1 172.38.0.14:6379</span><br><span class="line">   replicates c29901af4a69775d0803fe3d44d5d37990bd7629</span><br><span class="line">S: 753719c7fd2094a3ec895f0ed281cd86978c20c2 172.38.0.15:6379</span><br><span class="line">   replicates d6a1c22c527f7de1d1dc9d3c7585ae6bd6a73aaf</span><br><span class="line">S: 85f77b3cfd2c7b64fa5b4116a07e5da3177fabb5 172.38.0.16:6379</span><br><span class="line">   replicates a97fe82c442665eeb3c00537a3fad7973ed07c32</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: d6a1c22c527f7de1d1dc9d3c7585ae6bd6a73aaf 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: c29901af4a69775d0803fe3d44d5d37990bd7629 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 753719c7fd2094a3ec895f0ed281cd86978c20c2 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d6a1c22c527f7de1d1dc9d3c7585ae6bd6a73aaf</span><br><span class="line">M: a97fe82c442665eeb3c00537a3fad7973ed07c32 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b69ee45a1dcdd8ac7f9c29005c26b47dc178e2a1 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates c29901af4a69775d0803fe3d44d5d37990bd7629</span><br><span class="line">S: 85f77b3cfd2c7b64fa5b4116a07e5da3177fabb5 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates a97fe82c442665eeb3c00537a3fad7973ed07c32</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>

<p><strong>查看集群信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:86</span><br><span class="line">cluster_stats_messages_pong_sent:86</span><br><span class="line">cluster_stats_messages_sent:172</span><br><span class="line">cluster_stats_messages_ping_received:81</span><br><span class="line">cluster_stats_messages_pong_received:86</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:172</span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">c29901af4a69775d0803fe3d44d5d37990bd7629 172.38.0.13:6379@16379 master - 0 1680271551760 3 connected 10923-16383</span><br><span class="line">753719c7fd2094a3ec895f0ed281cd86978c20c2 172.38.0.15:6379@16379 slave d6a1c22c527f7de1d1dc9d3c7585ae6bd6a73aaf 0 1680271551000 5 connected</span><br><span class="line">a97fe82c442665eeb3c00537a3fad7973ed07c32 172.38.0.12:6379@16379 master - 0 1680271551560 2 connected 5461-10922</span><br><span class="line">d6a1c22c527f7de1d1dc9d3c7585ae6bd6a73aaf 172.38.0.11:6379@16379 myself,master - 0 1680271548000 1 connected 0-5460</span><br><span class="line">b69ee45a1dcdd8ac7f9c29005c26b47dc178e2a1 172.38.0.14:6379@16379 slave c29901af4a69775d0803fe3d44d5d37990bd7629 0 1680271550055 4 connected</span><br><span class="line">85f77b3cfd2c7b64fa5b4116a07e5da3177fabb5 172.38.0.16:6379@16379 slave a97fe82c442665eeb3c00537a3fad7973ed07c32 0 1680271551000 6 connected</span><br><span class="line"><span class="meta">#</span><span class="bash"> 填写一条数据 发现分配到03，我们把03停了</span></span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 172.38.0.13:6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止03</span></span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                                                                      NAMES</span><br><span class="line">6e59baf52688   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:6376-&gt;6379/tcp, :::6376-&gt;6379/tcp, 0.0.0.0:16376-&gt;16379/tcp, :::16376-&gt;16379/tcp   redis-6</span><br><span class="line">e17eecce1c85   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:6375-&gt;6379/tcp, :::6375-&gt;6379/tcp, 0.0.0.0:16375-&gt;16379/tcp, :::16375-&gt;16379/tcp   redis-5</span><br><span class="line">ebbd73cb5799   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:6374-&gt;6379/tcp, :::6374-&gt;6379/tcp, 0.0.0.0:16374-&gt;16379/tcp, :::16374-&gt;16379/tcp   redis-4</span><br><span class="line">7c22ecd784d5   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:6373-&gt;6379/tcp, :::6373-&gt;6379/tcp, 0.0.0.0:16373-&gt;16379/tcp, :::16373-&gt;16379/tcp   redis-3</span><br><span class="line">e8e67c6007a2   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:6372-&gt;6379/tcp, :::6372-&gt;6379/tcp, 0.0.0.0:16372-&gt;16379/tcp, :::16372-&gt;16379/tcp   redis-2</span><br><span class="line">eea49e406a0b   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   7 minutes ago   Up 7 minutes   0.0.0.0:6371-&gt;6379/tcp, :::6371-&gt;6379/tcp, 0.0.0.0:16371-&gt;16379/tcp, :::16371-&gt;16379/tcp   redis-1</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ ~]# docker stop 7c22ecd784d5</span><br><span class="line">7c22ecd784d5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新获取 get a，在14得到</span></span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 172.38.0.14:6379</span></span><br><span class="line">&quot;b&quot;</span><br></pre></td></tr></table></figure>

<h3 id="7-5-SpringBoot微服务打包Docker镜像"><a href="#7-5-SpringBoot微服务打包Docker镜像" class="headerlink" title="7.5 SpringBoot微服务打包Docker镜像"></a>7.5 SpringBoot微服务打包Docker镜像</h3><p>1、 构建SpringBoot微服务项目</p>
<p>用idea构建</p>
<p><img src="/2022/12/02/docker/image-20230331222223486.png" alt="image-20230331222223486"></p>
<p>2、创建Dockerfile</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、将jar包和Dockerfile上传，运行执行命令，然后运行命令构建，最后访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ idea]# docker build -t fyspringboot .</span><br><span class="line">[+] Building 30.5s (7&#x2F;7) FINISHED                                                                                                                                                                                 </span><br><span class="line"> &#x3D;&gt; [internal] load build definition from Dockerfile                                                                                                                                                         0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; transferring dockerfile: 167B                                                                                                                                                                         0.0s</span><br><span class="line"> &#x3D;&gt; [internal] load .dockerignore                                                                                                                                                                            0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; transferring context: 2B                                                                                                                                                                              0.0s</span><br><span class="line"> &#x3D;&gt; [internal] load metadata for docker.io&#x2F;library&#x2F;java:8                                                                                                                                                    0.9s</span><br><span class="line"> &#x3D;&gt; [internal] load build context                                                                                                                                                                            0.1s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; transferring context: 17.67MB                                                                                                                                                                         0.1s</span><br><span class="line"> &#x3D;&gt; [1&#x2F;2] FROM docker.io&#x2F;library&#x2F;java:8@sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d                                                                                             27.9s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; resolve docker.io&#x2F;library&#x2F;java:8@sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d                                                                                              0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:5040bd2983909aa8896b9932438c3f1479d25ae837a5f6220242a264d0221f2d 51.36MB &#x2F; 51.36MB                                                                                                            15.2s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:fce5728aad85a763fe3c419db16885eb6f7a670a42824ea618414b8fb309ccde 18.54MB &#x2F; 18.54MB                                                                                                             3.1s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:76610ec20bf5892e24cebd4153c7668284aa1d1151b7c3b0c7d50c579aa5ce75 42.50MB &#x2F; 42.50MB                                                                                                            15.1s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d 2.00kB &#x2F; 2.00kB                                                                                                               0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:d23bdf5b1b1b1afce5f1d0fd33e7ed8afbc084b594b9ccf742a5b27080d8a4a8 4.73kB &#x2F; 4.73kB                                                                                                               0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:60170fec2151d2108ed1420625c51138434ba4e0223d3023353d3f32ffe3cfc2 593.15kB &#x2F; 593.15kB                                                                                                           3.5s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:e98f73de8f0d2ef292f58b004d67bc6e9ee779dcfaff7ebb3964649d4787b872 214B &#x2F; 214B                                                                                                                   3.8s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:11f7af24ed9cf47597dd6cf9963bb3e9109c963f0135e869a9e9b4999fdc12a3 242B &#x2F; 242B                                                                                                                   4.1s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:49e2d6393f32abb1de7c9395c04c822ceb2287383d5a90998f7bd8dbfd43d48c 130.10MB &#x2F; 130.10MB                                                                                                          22.2s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; sha256:bb9cdec9c7f337940f7d872274353b66e118412cbfd433c711361bcf7922aea4 289.05kB &#x2F; 289.05kB                                                                                                          15.4s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:5040bd2983909aa8896b9932438c3f1479d25ae837a5f6220242a264d0221f2d                                                                                                                    2.3s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:fce5728aad85a763fe3c419db16885eb6f7a670a42824ea618414b8fb309ccde                                                                                                                    0.8s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:76610ec20bf5892e24cebd4153c7668284aa1d1151b7c3b0c7d50c579aa5ce75                                                                                                                    2.3s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:60170fec2151d2108ed1420625c51138434ba4e0223d3023353d3f32ffe3cfc2                                                                                                                    0.1s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:e98f73de8f0d2ef292f58b004d67bc6e9ee779dcfaff7ebb3964649d4787b872                                                                                                                    0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:11f7af24ed9cf47597dd6cf9963bb3e9109c963f0135e869a9e9b4999fdc12a3                                                                                                                    0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:49e2d6393f32abb1de7c9395c04c822ceb2287383d5a90998f7bd8dbfd43d48c                                                                                                                    5.4s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; extracting sha256:bb9cdec9c7f337940f7d872274353b66e118412cbfd433c711361bcf7922aea4                                                                                                                    0.1s</span><br><span class="line"> &#x3D;&gt; [2&#x2F;2] COPY *.jar &#x2F;app.jar                                                                                                                                                                                1.5s</span><br><span class="line"> &#x3D;&gt; exporting to image                                                                                                                                                                                       0.1s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; exporting layers                                                                                                                                                                                      0.1s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; writing image sha256:8468f1a8578e999009e1a42643c0608ed6dea67a8fec2d79f1a3d644100d3fd7                                                                                                                 0.0s</span><br><span class="line"> &#x3D;&gt; &#x3D;&gt; naming to docker.io&#x2F;library&#x2F;fyspringboot                                                                                                                                                              0.0s</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ idea]# docker images</span><br><span class="line">REPOSITORY       TAG                IMAGE ID       CREATED         SIZE</span><br><span class="line">fyspringboot     latest             8468f1a8578e   8 seconds ago   661MB</span><br><span class="line">ip-test-centos   0.1                99feb15e4be3   5 days ago      639MB</span><br><span class="line">kicbase&#x2F;stable   v0.0.37            01c0ce65fff7   2 months ago    1.15GB</span><br><span class="line">tomcat           latest             fb5657adc892   15 months ago   680MB</span><br><span class="line">redis            5.0.9-alpine3.11   3661c84ee9d0   2 years ago     29.8MB</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ idea]# docker run -d -P --name fy-docker-springboot-web </span><br><span class="line">&quot;docker run&quot; requires at least 1 argument.</span><br><span class="line">See &#39;docker run --help&#39;.</span><br><span class="line"></span><br><span class="line">Usage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">Create and run a new container from an image</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ idea]# docker run -d -P --name fy-docker-springboot-web fyspringboot</span><br><span class="line">7313c3add050f4c2959660bf03b457ecefadf74db6685b4e3c69cf1fa703ef39</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ idea]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                         NAMES</span><br><span class="line">7313c3add050   fyspringboot   &quot;java -jar &#x2F;app.jar …&quot;   4 seconds ago   Up 3 seconds   0.0.0.0:32782-&gt;8080&#x2F;tcp, :::32782-&gt;8080&#x2F;tcp   fy-docker-springboot-web</span><br><span class="line">[root@iZ0jl8mpf6u9turvttqoldZ idea]# curl localhost:32782&#x2F;hello</span><br><span class="line">hello,fy[root@iZ0jl8mpf6u9turvttqoldZ idea]# curl localhost:32782&#x2F;hello</span><br><span class="line">hello,fy</span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/docker%E5%AD%A6%E4%B9%A0/" rel="tag"># docker学习</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/09/26/centos8%E5%AE%89%E8%A3%85py3-8/" rel="next" title="centos8安装py3.8">
                <i class="fa fa-chevron-left"></i> centos8安装py3.8
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2023/01/14/acwingSpringBoot/" rel="prev" title="acwingSpringBoot">
                acwingSpringBoot <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">45</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Docker%E5%AD%A6%E4%B9%A0"><span class="nav-number">1.</span> <span class="nav-text">1. Docker学习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Docker%E6%A6%82%E8%BF%B0"><span class="nav-number">2.</span> <span class="nav-text">2. Docker概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Docker%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0%EF%BC%9F"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 Docker为什么会出现？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Docker%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 Docker的历史</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Docker%E8%83%BD%E5%B9%B2%E5%90%97%EF%BC%9F"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 Docker能干吗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 Docker的基本组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E5%AE%89%E8%A3%85Docker"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 安装Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E9%85%8D%E7%BD%AE%E9%98%BF%E9%87%8C%E4%BA%91%E5%8A%A0%E9%80%9F"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 配置阿里云加速</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-%E5%9B%9E%E9%A1%BEHelloWorld%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-number">2.7.</span> <span class="nav-text">2.7 回顾HelloWorld的流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="nav-number">2.8.</span> <span class="nav-text">2.8 底层原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Docker%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">3.</span> <span class="nav-text">3. Docker的常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 帮助命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 镜像命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 容器命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-%E6%96%B0%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%B9%B6%E5%90%AF%E5%8A%A8"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 新建容器并启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.3.2 删除容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-%E5%90%AF%E5%8A%A8%E5%92%8C%E5%81%9C%E6%AD%A2%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3.3 启动和停止容器操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-%E5%B8%B8%E7%94%A8%E7%9A%84%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="nav-number">3.3.4.</span> <span class="nav-text">3.3.4 常用的其他命令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-1-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8"><span class="nav-number">3.3.4.1.</span> <span class="nav-text">3.3.4.1 后台启动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-2-%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="nav-number">3.3.4.2.</span> <span class="nav-text">3.3.4.2 查看日志</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-3-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="nav-number">3.3.4.3.</span> <span class="nav-text">3.3.4.3 查看容器中的进程信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-4-%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E4%B8%AD%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF"><span class="nav-number">3.3.4.4.</span> <span class="nav-text">3.3.4.4 查看镜像中的元数据信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-5-%E8%BF%9B%E5%85%A5%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="nav-number">3.3.4.5.</span> <span class="nav-text">3.3.4.5 进入正在运行的容器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-6-%E4%BB%8E%E5%AE%B9%E5%99%A8%E5%86%85%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%BB%E6%9C%BA%E4%B8%8A"><span class="nav-number">3.3.4.6.</span> <span class="nav-text">3.3.4.6 从容器内拷贝文件到主机上</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-%E6%80%BB%E7%BB%93"><span class="nav-number">3.3.5.</span> <span class="nav-text">3.4 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Docker%E7%BB%83%E4%B9%A0%E4%BD%BF%E7%94%A8"><span class="nav-number">3.4.</span> <span class="nav-text">3.4. Docker练习使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1%E9%83%A8%E7%BD%B2Nginx"><span class="nav-number">3.4.1.</span> <span class="nav-text">3.4.1部署Nginx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-%E9%83%A8%E7%BD%B2Tomact"><span class="nav-number">3.4.2.</span> <span class="nav-text">3.4.2 部署Tomact</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-%E9%83%A8%E7%BD%B2es-kibana"><span class="nav-number">3.4.3.</span> <span class="nav-text">3.4.3 部署es + kibana</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">3.5.</span> <span class="nav-text">3.5. 可视化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="nav-number">4.</span> <span class="nav-text">4. Docker镜像讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 镜像是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 分层理解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-commit%E9%95%9C%E5%83%8F"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 commit镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">5.</span> <span class="nav-text">5. 容器数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 什么是容器数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 使用数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2MySQL"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 实战：部署MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E5%85%B7%E5%90%8D%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 具名和匿名挂载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-%E5%88%9D%E8%AF%86DockerFile"><span class="nav-number">5.5.</span> <span class="nav-text">5.5 初识DockerFile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="nav-number">5.6.</span> <span class="nav-text">5.6 数据卷容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-DockerFile"><span class="nav-number">6.</span> <span class="nav-text">6. DockerFile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-DockerFile%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 DockerFile的介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-Docker%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 Docker的构建过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-DockerFile%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 DockerFile的指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8"><span class="nav-number">6.4.</span> <span class="nav-text">6.4 实战应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-%E5%AE%9E%E6%88%98-Tomcat%E9%95%9C%E5%83%8F"><span class="nav-number">6.5.</span> <span class="nav-text">6.5 实战:Tomcat镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-6-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="nav-number">6.6.</span> <span class="nav-text">6.6 发布自己的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-7-Docker%E7%9A%84%E6%89%80%E6%9C%89%E6%B5%81%E7%A8%8B%E5%B0%8F%E7%BB%93"><span class="nav-number">6.7.</span> <span class="nav-text">6.7 Docker的所有流程小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Docker%E7%BD%91%E7%BB%9C"><span class="nav-number">7.</span> <span class="nav-text">7. Docker网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E7%90%86%E8%A7%A3Docker%E7%BD%91%E7%BB%9C"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 理解Docker网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 自定义网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="nav-number">7.3.</span> <span class="nav-text">7.3 网络连通</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-%E9%83%A8%E7%BD%B2Redis%E9%9B%86%E7%BE%A4"><span class="nav-number">7.4.</span> <span class="nav-text">7.4 部署Redis集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-SpringBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%93%E5%8C%85Docker%E9%95%9C%E5%83%8F"><span class="nav-number">7.5.</span> <span class="nav-text">7.5 SpringBoot微服务打包Docker镜像</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">❤feiyangHuang</span>

  
</div>


  <div class="powered-by">Powered by fy</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">
   博客-feiyang
   </div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/qwe/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/qwe/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/qwe/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/qwe/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/qwe/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/qwe/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
